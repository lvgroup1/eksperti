"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{4857:(e,t,l)=>{l.r(t),l.d(t,{default:()=>y});var a=l(7876),n=l(4232);let i=["Swedbank","Gjensidige","Compensa","IF","BTA","Balta"],r=["Komerctelpa","Dzīvojamā ēka"],o=["Privātmāja","Daudzdzīvokļu māja","Rindu māja","Cits"],s=["CTA","Plūdi","Uguns","Koks","Cits"],c=["Jā","Nē"],d=["Virtuve","Guļamistaba","Koridors","Katla telpa","Dzīvojamā istaba","Vannas istaba","Tualete","Garderobe","Cits"];function u(e){if(null==e||""===e)return 0;let t=parseFloat(String(e).replace(/\s+/g,"").replace(",","."));return Number.isFinite(t)?t:0}function m(e){if(!e)return"";let t=String(e).trim().toLowerCase().replace("\xb2","2").replace("\xa0"," ").replace("  "," ");return"gb."===t||"gab."===t||"gab"===t?"gab":"m2"===t||"m 2"===t||"m^2"===t?"m2":"m3"===t||"m 3"===t||"m^3"===t?"m3":"m"===t?"m":"kpl"===t||"kpl."===t?"kpl":"diena"===t?"diena":"c/h"===t?"c/h":"obj."===t||"obj"===t?"obj":t}let p=["m2","m3","m","gab","kpl","diena","obj","c/h"],g=e=>!0===e||1===e||"1"===e||"string"==typeof e&&["true","yes","y","jā"].includes(e.trim().toLowerCase()),h=e=>String(null!=e?e:"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/\s+/g," "),f=e=>g(e.is_child)||g(e.child)||!!e.parent_uid||!!e.parentUid||!!e.parent_id||!!e.parentId||!!e.parent||!!e.parent_name||!!e.parentName||!!e.childOf,b={"jumta nesošās konstrukciju montāža (mūrlata, kopnes,spares, sijas, balstbrusas)":["impregnēta koka brusa","montāžas elementi"]};function v(e,t){var l,a,n,i,r,o;let s=Number(null!=(l=e.labor)?l:0)||0,c=Number(null!=(a=e.mechanisms)?a:0)||0,d=Number(null!=(i=e.materials)?i:s||c?0:null!=(n=e.unit_price)?n:0)||0;return{name:e.name||"",unit:m(e.unit||t||""),coeff:Number(null!=(o=null!=(r=e.coeff)?r:e.multiplier)?o:1)||1,labor:s,materials:d,mechanisms:c}}let x=n.memo(function(e){let{label:t,children:l}=e;return(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("div",{style:{fontWeight:600,marginBottom:6},children:t}),(0,a.jsx)("div",{children:l})]})}),C=n.memo(function(e){let{title:t,children:l}=e;return(0,a.jsxs)("div",{style:{background:"white",padding:16,borderRadius:12,boxShadow:"0 1px 4px rgba(0,0,0,0.06)"},children:[(0,a.jsx)("div",{style:{fontSize:18,fontWeight:700,marginBottom:10},children:t}),l]})});function y(){var e,t,y,j;let[k,w]=(0,n.useState)(1),[S,N]=(0,n.useState)(""),[R,z]=(0,n.useState)(""),[L,B]=(0,n.useState)(""),[I,_]=(0,n.useState)(""),[A,T]=(0,n.useState)("Balta"),[D,U]=(0,n.useState)(""),[F,M]=(0,n.useState)(""),[E,O]=(0,n.useState)(""),[J,P]=(0,n.useState)(""),[K,V]=(0,n.useState)(""),[W,q]=(0,n.useState)("Nē"),[G,H]=(0,n.useState)("Nē"),[X,Y]=(0,n.useState)("Nē"),[Z,Q]=(0,n.useState)("Nē"),[$,ee]=(0,n.useState)(""),[et,el]=(0,n.useState)(d.reduce((e,t)=>(e[t]={checked:!1,count:1,custom:""},e),{})),[ea,en]=(0,n.useState)([]),[ei,er]=(0,n.useState)({}),[eo,es]=(0,n.useState)(null),[ec,ed]=(0,n.useState)([]),[eu,em]=(0,n.useState)(""),[ep,eg]=(0,n.useState)(new Map),[eh,ef]=(0,n.useState)(new Set);(0,n.useEffect)(()=>{if("Balta"!==A){ed([]),eg(new Map),ef(new Set);return}em(""),(async()=>{try{let e,t=async e=>{let t=await fetch(e,{cache:"no-store"});if(!t.ok)throw Error("".concat(t.status," ").concat(t.statusText));let l=await t.json();return Array.isArray(l)?l:Array.isArray(l.items)?l.items:[]};try{e=await t("prices/balta.v2.json")}catch(l){e=await t("prices/balta.json")}let l=[],a=[];e.forEach((e,t)=>{var n,i,r,o,s,c,d,p;let h=(e.category||"").trim(),f=(e.subcategory||e.subcat||e.group||e.grupa||e["apakškategorija"]||"").trim(),b=String(null!=(n=e.id)?n:t),v=(e.name||"").trim(),x=[h,f,b,v].join("::"),C=e.parent_uid||e.parentUid||e.parent_id||e.parentId||e.parent||e.parent_name||e.parentName||e.childOf||null,y=g(e.is_child)||!!C,j={id:b,uid:x,name:v,category:h,subcategory:f,unit:m(e.unit),unit_price:u(e.unit_price),labor:u(null!=(i=e.labor)?i:e.darbs),materials:u(null!=(o=null!=(r=e.materials)?r:e.materiāli)?o:e.materiali),mechanisms:u(null!=(c=null!=(s=e.mechanisms)?s:e.mehānismi)?c:e.mehanismi),is_child:y,parent_uid:C||null};if(y)a.push({...j,coeff:u(null!=(p=null!=(d=e.coeff)?d:e.multiplier)?p:1)||1,parent_key:e.parent_key||e.parentKey||null});else{let t={...j};l.push(t);let n=Array.isArray(e.children)&&e.children||Array.isArray(e.komponentes)&&e.komponentes||Array.isArray(e.apaks)&&e.apaks||[];if(n.length){let l=[];n.forEach((t,n)=>{var i,r,o;let s=(t.name||t.title||"").trim();if(!s)return;let c={id:"".concat(b,"-c").concat(n),uid:[h,f,"".concat(b,"-c").concat(n),s].join("::"),name:s,category:h,subcategory:f,unit:m(t.unit||e.unit),unit_price:u(t.unit_price),labor:u(t.labor),materials:u(null!=(i=t.materials)?i:t.labor||t.mechanisms?0:t.unit_price),mechanisms:u(t.mechanisms),is_child:!0,parent_uid:x,coeff:u(null!=(o=null!=(r=t.coeff)?r:t.multiplier)?o:1)||1};a.push(c),l.push({name:c.name,unit:c.unit,coeff:c.coeff||1,labor:c.labor||0,materials:c.materials||0,mechanisms:c.mechanisms||0})}),t.children=l}}});let n=[...l,...a];ed(n);let i=function(e){let t=new Map,l=(e,l)=>{let a=h(e);if(!a)return;let n=t.get(a)||[];n.push(l),t.set(a,n)};for(let t of e)f(t)&&[t.parent_uid,t.parentUid,t.parent_id,t.parentId,t.parent,t.parent_name,t.parentName,t.childOf,t.parent_key,t.parentKey].forEach(e=>l(e,t));return t}(n);eg(i);let r=new Set,o=l.reduce((e,t)=>{let l=h(t.name);return(e.get(l)||e.set(l,[]).get(l)).push(t),e},new Map);for(let[e,t]of Object.entries(b)){let l=o.get(e);if(l)for(let e of l)for(let l of t){let t=h(l);n.filter(l=>h(l.name)===t&&l.category===e.category).forEach(e=>r.add(e.uid))}}ef(r)}catch(e){em("Neizdevās ielādēt BALTA cenas: ".concat(e.message))}})()},[A]);let eb=(0,n.useCallback)(e=>{let t=[],l=new Set;if(Array.isArray(e.children)&&e.children.length)for(let a of e.children){let n=v(a,e.unit),i="".concat(h(n.name),"::").concat(h(n.unit));l.has(i)||(l.add(i),t.push(n))}for(let a of[e.uid,e.id,e.name,"".concat(e.category,"::").concat(e.name)].map(h)){let n=ep.get(a);if(n)for(let a of n){let n=v(a,e.unit),i=a.uid||"".concat(h(n.name),"::").concat(h(n.unit));l.has(i)||(l.add(i),t.push(n))}}if(0===t.length){let l=b[h(e.name)];if(l&&l.length){for(let a of l){let l=h(a),n=ec.find(t=>h(t.name)===l&&t.category===e.category);n&&t.push(v(n,e.unit))}t.length&&console.warn("[HINT] Using name-based children for parent: ".concat(e.name))}}return t},[ep,ec]),ev=(0,n.useMemo)(()=>Array.from(new Set(ec.map(e=>e.category).filter(Boolean))),[ec]),ex=(0,n.useMemo)(()=>{let e=new Set(p);return ec.forEach(t=>t.unit&&e.add(m(t.unit))),Array.from(e)},[ec]),[eC,ey]=(0,n.useState)([]);(0,n.useEffect)(()=>ey(function(){try{let e=localStorage.getItem("tames_profils_saglabatie");return e?JSON.parse(e):[]}catch(e){return[]}}()),[]),(0,n.useEffect)(()=>{let e=[];Object.entries(et).forEach(t=>{let[l,a]=t;if(!a.checked)return;let n=Math.max(1,Number(a.count)||1);for(let t=1;t<=n;t++){let n="".concat(l,"-").concat(t),i=ea.find(e=>e.id===n);e.push({id:n,type:"Cits"===l?a.custom||"Cits":l,index:t,note:(null==i?void 0:i.note)||""})}}),en(e),er(t=>{let l={};return e.forEach(e=>{l[e.id]=t[e.id]||[{category:"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]}),l})},[et]);let ej=n.useMemo(()=>{let e=new Map,t=(ec||[]).filter(e=>!f(e));function l(e,t){var l,a,n,i,r,o;let s=Number(null!=(l=null==e?void 0:e.labor)?l:0)||0,c=Number(null!=(a=null==e?void 0:e.mechanisms)?a:0)||0,d=Number(null!=(i=null==e?void 0:e.materials)?i:s||c?0:null!=(n=null==e?void 0:e.unit_price)?n:0)||0;return{name:(null==e?void 0:e.name)||"",unit:m((null==e?void 0:e.unit)||t||""),coeff:Number(null!=(o=null!=(r=null==e?void 0:e.coeff)?r:null==e?void 0:e.multiplier)?o:1)||1,labor:s,materials:d,mechanisms:c}}for(let a of(ec||[]).filter(e=>f(e))){let n=t.find(e=>(function(e,t){let l=new Set([h(t.uid),h(t.id),h(t.name),h(t.category+"::"+t.name)]);return[e.parent_uid,e.parentUid,e.parent_id,e.parentId,e.parent,e.parent_name,e.parentName,e.childOf,e.parent_key,e.parentKey].map(h).filter(Boolean).some(e=>l.has(e))})(a,e));if(!n)continue;let i=n.uid,r=e.get(i)||[],o=l(a,n.unit);r.some(e=>h(e.name)===h(o.name)&&m(e.unit)===m(o.unit))||r.push(o),e.set(i,r)}for(let a of t){let t=Array.isArray(a.children)?a.children:[];if(!t.length)continue;let n=a.uid,i=e.get(n)||[];for(let e of t){let t=l(e,a.unit);i.some(e=>h(e.name)===h(t.name)&&m(e.unit)===m(t.unit))||i.push(t)}e.set(n,i)}return e},[ec]);function ek(e,t,l,a){er(n=>{let i=[...n[e]||[]],r={...i[t],[l]:a};return i[t]=r,{...n,[e]:i}})}let ew=(0,n.useMemo)(()=>{switch(k){case 1:return!!I.trim();case 2:return!!A;case 3:return!!D&&("Dzīvojamā ēka"!==D||!!F);case 4:return!!J&&("Cits"!==J||!!K.trim());case 5:return["Jā","Nē"].includes(W);case 6:return["Jā","Nē"].includes(G);case 7:return["Jā","Nē"].includes(X);case 8:return"Nē"===Z||"Jā"===Z&&!!$&&Number($)>=0;case 9:return Object.values(et).some(e=>e.checked);default:return!0}},[k,I,A,D,F,J,K,W,G,X,Z,$,et]);async function eS(){try{var e,t;let a=e=>String(e).padStart(2,"0"),n=await l.e(22).then(l.t.bind(l,1980,23)),i=(null==n?void 0:n.default)||n,r=(null==(e=window.__NEXT_DATA__)?void 0:e.assetPrefix)||window.location.pathname.startsWith("/eksperti")?"/eksperti":"",o="".concat(r,"/templates/balta_template.xlsx"),s=await fetch(o);if(!s.ok)return void alert("Neizdevās ielādēt ".concat(o,". Pārliecinies, ka fails ir public/templates/balta_template.xlsx"));let c=await s.arrayBuffer(),d=new i.Workbook;await d.xlsx.load(c);let p=d.getWorksheet("Tāme")||d.worksheets[0],g=d.addWorksheet("Tāme (izvade)",{views:[{showGridLines:!1}]}),h={name:"Calibri",size:11},f="#,##0.00",b={style:"thin"},v={top:b,left:b,bottom:b,right:b},x={type:"pattern",pattern:"solid",fgColor:{argb:"FFF3F6FD"}},C={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFEFEF"}},y=new Date,j="".concat(y.getFullYear()).concat(a(y.getMonth()+1)).concat(a(y.getDate())),k="Balta"===A?"B-".concat(j):j,w="Balta"===A?"LOKĀLĀ TĀME NR.".concat(k):"TĀMES NR.: ".concat(k),S=y.toLocaleDateString("lv-LV",{year:"numeric",month:"long",day:"numeric"});g.getCell("A1").value="Pasūtītājs: ".concat(A||"Balta"),g.getCell("A2").value="Objekts: ".concat(D||"").concat(F?" – "+F:""),g.getCell("A3").value="Objekta adrese: ".concat(I||""),g.getCell("A8").value="Rīga, ".concat(S),g.getCell("A9").value="Pamatojums: apdrošināšanas lieta Nr. ".concat(L||"—"),g.getCell("J1").value="LV GROUP SIA",g.getCell("J2").value="Reģ. Nr.: LV40003216553",g.getCell("J3").value="Banka: Luminor",g.getCell("J4").value="Konts: LV12RIKO0002012345678",g.mergeCells(6,2,6,12);let N=g.getCell(6,2);N.value=w,N.font={...h,size:16,bold:!0},N.alignment={horizontal:"center",vertical:"middle"};let R=[];if(ea.forEach(e=>{(ei[e.id]||[]).forEach(t=>{var l,a,n,i,r,o,s,c,d,p,g,h,f,b,v;let x=u(t.quantity);if(!x)return;let C=ec.find(e=>e.uid===t.itemUid)||ec.find(e=>e.id===t.itemId);if(!C)return;let y=m(t.unit||C.unit||""),j=u(null!=(a=null!=(l=t.labor)?l:C.labor)?a:0),k=u(null!=(i=null!=(n=t.materials)?n:C.materials)?i:0),w=u(null!=(o=null!=(r=t.mechanisms)?r:C.mechanisms)?o:0),S=j+k+w||u(null!=(c=null!=(s=t.unit_price)?s:C.unit_price)?c:0);R.push({isChild:!1,room:"".concat(e.type," ").concat(e.index),name:t.itemName||C.name||"",unit:y,qty:x,labor:j,materials:k,mechanisms:w,unitPrice:S});let N=ej.get(C.uid)||[];for(let t of(N.length||(N=eb(C)),N)){let l=u(null!=(d=t.coeff)?d:1)*x;R.push({isChild:!0,room:"".concat(e.type," ").concat(e.index),name:t.name||"",unit:m(t.unit||y),qty:l,labor:u(null!=(p=t.labor)?p:0),materials:u(null!=(g=t.materials)?g:0),mechanisms:u(null!=(h=t.mechanisms)?h:0),unitPrice:u(null!=(f=t.labor)?f:0)+u(null!=(b=t.materials)?b:0)+u(null!=(v=t.mechanisms)?v:0)})}})}),!R.length)return void alert("Nav nevienas pozīcijas ar daudzumu.");for(let e of(g.getCell(13,1).value="Nr.",g.getCell(13,2).value="Darbu nosaukums",g.getCell(13,3).value="Mērv.",g.getCell(13,4).value="Daudz.",g.mergeCells(13,5,13,8),g.getCell(13,5).value="Vienības cena, EUR",g.mergeCells(13,9,13,12),g.getCell(13,9).value="Summa, EUR",g.getCell(14,5).value="Darbs",g.getCell(14,6).value="Materiāli",g.getCell(14,7).value="Mehānismi",g.getCell(14,8).value="Cena",g.getCell(14,9).value="Darbs",g.getCell(14,10).value="Materiāli",g.getCell(14,11).value="Mehānismi",g.getCell(14,12).value="Kopā",[13,14])){let t=g.getRow(e);for(let e=1;e<=12;e++){let l=t.getCell(e);l.font={...h,bold:!0},l.alignment={horizontal:"center",vertical:"middle",wrapText:!0},l.fill=C,l.border=v}t.height=22}let z=15,B=1,_=null,T=null,U=new Map;for(let[e,t]of(R.forEach(e=>{U.has(e.room)||U.set(e.room,[]),U.get(e.room).push(e)}),U.entries())){g.mergeCells(z,2,z,12);let l=g.getCell(z,2);for(let a of(l.value=e,l.fill=x,l.font={...h,bold:!0},l.alignment={wrapText:!0,vertical:"middle"},l.border={bottom:b},g.getRow(z).height=18,z++,t)){let e=g.getRow(z);e.getCell(1).value=a.isChild?"":B++,e.getCell(2).value=a.isChild?"    ".concat(a.name):a.name,e.getCell(3).value=a.unit,e.getCell(4).value=a.qty;let t=a.labor||0,l=a.materials||0,n=a.mechanisms||0,i=t+l+n>0;for(let r of(e.getCell(5).value=i?t:a.unitPrice,e.getCell(6).value=i?l:0,e.getCell(7).value=i?n:0,e.getCell(8).value={formula:"ROUND(SUM(E".concat(z,":G").concat(z,"),2)")},e.getCell(9).value={formula:"ROUND(E".concat(z,"*D").concat(z,",2)")},e.getCell(10).value={formula:"ROUND(F".concat(z,"*D").concat(z,",2)")},e.getCell(11).value={formula:"ROUND(G".concat(z,"*D").concat(z,",2)")},e.getCell(12).value={formula:"ROUND(H".concat(z,"*D").concat(z,",2)")},e.getCell(4).numFmt="#,##0.00",[5,6,7,8,9,10,11,12]))e.getCell(r).numFmt=f;let r=(z-15)%2==1;for(let t=1;t<=12;t++){let l=e.getCell(t);r&&(l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}}),l.border=v,l.font={...h,italic:!!a.isChild},l.alignment=2===t?{wrapText:!0,vertical:"middle"}:{vertical:"middle",horizontal:"right"}}null===_&&(_=z),T=z,z++}}let M=e=>{g.getCell(e).font={...h,bold:!0}},E=z+1;for(let e of(g.getCell("B".concat(E)).value="Kopā",g.getCell("I".concat(E)).value={formula:_?"SUM(I".concat(_,":I").concat(T,")"):"0"},g.getCell("J".concat(E)).value={formula:_?"SUM(J".concat(_,":J").concat(T,")"):"0"},g.getCell("K".concat(E)).value={formula:_?"SUM(K".concat(_,":K").concat(T,")"):"0"},g.getCell("L".concat(E)).value={formula:_?"SUM(L".concat(_,":L").concat(T,")"):"0"},[9,10,11,12]))g.getCell(E,e).numFmt=f;M("B".concat(E));let O=E+1;g.getCell("B".concat(O)).value="Materiālu, grunts apmaiņas un būvgružu transporta izdevumi",g.getCell("C".concat(O)).value=.07,g.getCell("J".concat(O)).value={formula:"ROUND(J".concat(E,"*C").concat(O,",2)")},g.getCell("L".concat(O)).value={formula:"J".concat(O)},g.getCell("J".concat(O)).numFmt=f,g.getCell("L".concat(O)).numFmt=f;let J=O+1;for(let e of(g.getCell("B".concat(J)).value="Tiešās izmaksas kopā",g.getCell("I".concat(J)).value={formula:"I".concat(E)},g.getCell("J".concat(J)).value={formula:"ROUND(J".concat(E,"+J").concat(O,",2)")},g.getCell("K".concat(J)).value={formula:"K".concat(E)},g.getCell("L".concat(J)).value={formula:"ROUND(I".concat(J,"+J").concat(J,"+K").concat(J,",2)")},[9,10,11,12]))g.getCell(J,e).numFmt=f;M("B".concat(J));let P=J+1;g.getCell("B".concat(P)).value="Virsizdevumi",g.getCell("C".concat(P)).value=.09,g.getCell("L".concat(P)).value={formula:"ROUND(L".concat(J,"*C").concat(P,",2)")},g.getCell("L".concat(P)).numFmt=f;let K=P+1;g.getCell("B".concat(K)).value="Peļņa",g.getCell("C".concat(K)).value=.07,g.getCell("L".concat(K)).value={formula:"ROUND(L".concat(J,"*C").concat(K,",2)")},g.getCell("L".concat(K)).numFmt=f;let V=K+1;g.getCell("B".concat(V)).value="Darba devēja sociālais nodoklis",g.getCell("C".concat(V)).value=.2359,g.getCell("I".concat(V)).value={formula:"ROUND(I".concat(E,"*C").concat(V,",2)")},g.getCell("L".concat(V)).value={formula:"I".concat(V)},g.getCell("I".concat(V)).numFmt=f,g.getCell("L".concat(V)).numFmt=f;let W=V+1;g.getCell("B".concat(W)).value="Kopējās izmaksas",g.getCell("L".concat(W)).value={formula:"ROUND(L".concat(J,"+L").concat(P,"+L").concat(K,"+L").concat(V,",2)")},g.getCell("L".concat(W)).numFmt=f,M("B".concat(W)),M("L".concat(W));let q=W+1;g.getCell("B".concat(q)).value="PVN",g.getCell("C".concat(q)).value=.21,g.getCell("L".concat(q)).value={formula:"ROUND(L".concat(W,"*C").concat(q,",2)")},g.getCell("L".concat(q)).numFmt=f;let G=q+1;for(let e of(g.getCell("B".concat(G)).value="Pavisam kopā",g.getCell("L".concat(G)).value={formula:"ROUND(L".concat(W,"+L").concat(q,",2)")},g.getCell("L".concat(G)).numFmt=f,M("B".concat(G)),M("L".concat(G)),g.getCell("J9").value="Tāmes summa euro :",g.getCell("L9").value={formula:"L".concat(W)},g.getCell("L9").numFmt=f,g.getCell("J10").value="PVN 21%:",g.getCell("L10").value={formula:"L".concat(q)},g.getCell("L10").numFmt=f,g.getCell("J11").value="Pavisam kopā euro:",g.getCell("L11").value={formula:"L".concat(G)},g.getCell("L11").numFmt=f,[E,O,J,P,K,V,W,q,G]))for(let l=1;l<=12;l++){let a=g.getCell(e,l);a.border=v,a.font={...h,bold:(null==(t=a.font)?void 0:t.bold)||!1},a.alignment=2===l?{wrapText:!0,vertical:"middle"}:{vertical:"middle",horizontal:"right"}}let H=G+3;g.getCell("B".concat(H)).value="Piezīmes:",g.getCell("B".concat(H)).font={...h,bold:!0},g.mergeCells(H,2,H,12);let X=H+1;for(let e of["1. Tāmes derīguma termiņš – 1 mēnesis.","2. Tāme sastādīta provizoriski, atbilstoši bojātā īpašuma apskates protokolam un bildēm.","3. Iespējami slēpti defekti, kuri atklāsies remontdarbu laikā.","4. Tāme ir sagatavota elektroniski un ir autorizēta ar Nr.".concat(k,".")]){g.mergeCells(X,2,X,12);let t=g.getCell(X,2);t.value=e,t.font=h,t.alignment={wrapText:!0,vertical:"top"},X++}for(let e of ea.map(e=>(e.note||"").trim()).filter(Boolean)){g.mergeCells(X,2,X,12);let t=g.getCell(X,2);t.value=e,t.font=h,t.alignment={wrapText:!0,vertical:"top"},X++}let Y=X+2;g.mergeCells(Y,2,Y,6),g.getCell(Y,2).value="SASTĀDĪJA:",g.getCell(Y,2).font={...h,bold:!0},g.getCell(Y+1,2).value="Būvkomersanta Nr.:",g.mergeCells(Y+1,3,Y+1,6),g.getCell(Y+2,2).value="Vārds, uzvārds:",g.mergeCells(Y+2,3,Y+2,6),g.getCell(Y+3,2).value="sert. nr.:",g.mergeCells(Y+3,3,Y+3,6);let Z="Balta"===A?"AAS BALTA":A||"";g.mergeCells(Y,9,Y,12),g.getCell(Y,9).value="SASKAŅOTS:",g.getCell(Y,9).font={...h,bold:!0},g.mergeCells(Y+1,9,Y+1,12),g.getCell(Y+1,9).value=Z,g.mergeCells(Y+2,9,Y+2,12),g.getCell(Y+2,9).value="";let Q=[6,56,12,10,14,14,14,14,16,16,16,18];for(let e=1;e<=12;e++)g.getColumn(e).width=Q[e-1];d.removeWorksheet(p.id),g.name="Tāme";let $=await d.xlsx.writeBuffer(),ee=new Blob([$],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),et=URL.createObjectURL(ee),el=document.createElement("a");el.href=et,el.download="Tame_Balta_".concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e=>String(e).padStart(2,"0");return"".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate()),"_").concat(t(e.getHours()),"-").concat(t(e.getMinutes()))}(),".xlsx"),document.body.appendChild(el),el.click(),el.remove(),URL.revokeObjectURL(et)}catch(e){console.error("Excel export error:",e),alert("Neizdevās izveidot Excel failu. Skaties konsolē kļūdu.")}}let eN=(0,n.useCallback)(e=>t=>e(t.target.value),[]),eR=(0,n.useCallback)(e=>t=>e(t.target.value),[]),ez=Math.round((k-1)/11*100);return(0,a.jsx)("div",{style:{minHeight:"100vh",background:"#f7fafc",color:"#111827"},children:(0,a.jsxs)("div",{style:{maxWidth:1e3,margin:"0 auto",padding:16},children:[(0,a.jsx)("div",{style:{background:"white",padding:12,borderRadius:12,marginBottom:12},children:(0,a.jsx)(x,{label:"Lietas Nr.",children:(0,a.jsx)("input",{value:null!=L?L:"",onChange:eN(B),placeholder:"piem., CLV1234567",autoComplete:"off",spellCheck:!1,style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})}),(0,a.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:16},children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{fontSize:22,fontWeight:800},children:["Apskates forma – solis ",k,"/",12]}),(0,a.jsx)("div",{style:{fontSize:13,color:"#4b5563"},children:"Tāmētājs ievada tikai daudzumu. Cenas netiek rādītas formā un parādīsies tikai gala tāmē."})]}),(0,a.jsxs)("div",{style:{background:"white",padding:12,borderRadius:12,width:360},children:[(0,a.jsx)("div",{style:{fontWeight:600,marginBottom:6},children:"Tāmētāja profils (neobligāti)"}),(0,a.jsx)("input",{value:null!=S?S:"",onChange:eN(N),placeholder:"Vārds, Uzvārds",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,marginBottom:6}}),(0,a.jsx)("input",{value:null!=R?R:"",onChange:eN(z),placeholder:"E-pasts",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})]})]}),(0,a.jsx)("div",{style:{height:8,background:"#e5e7eb",borderRadius:999,marginBottom:16},children:(0,a.jsx)("div",{style:{width:"".concat(ez,"%"),height:8,background:"#10b981",borderRadius:999}})}),1===k&&(0,a.jsx)(C,{title:"1. Objekta adrese",children:(0,a.jsx)(x,{label:"Objekta adrese",children:(0,a.jsx)("input",{value:null!=I?I:"",onChange:eN(_),placeholder:"Iela 1, Pilsēta",autoComplete:"off",spellCheck:!1,style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})}),2===k&&(0,a.jsxs)(C,{title:"2. Apdrošināšanas kompānija",children:[(0,a.jsx)(x,{label:"Izvēlies kompāniju",children:(0,a.jsx)("select",{value:A,onChange:e=>T(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:i.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})}),"Balta"===A&&(0,a.jsx)("div",{style:{fontSize:12,color:eu?"#b91c1c":"#065f46"},children:eu||(ec.length?"Ielādēts BALTA cenrādis (".concat(ec.length," pozīcijas)"):"Notiek BALTA cenrāža ielāde...")})]}),3===k&&(0,a.jsxs)(C,{title:"3. Kur notika negadījums?",children:[(0,a.jsx)(x,{label:"Vieta",children:(0,a.jsxs)("select",{value:D,onChange:e=>U(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— Izvēlies —"}),r.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),"Dzīvojamā ēka"===D&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{label:"3.1. Dzīvojamās ēkas tips",children:(0,a.jsxs)("select",{value:F,onChange:e=>M(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— Izvēlies —"}),o.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),"Cits"===F&&(0,a.jsx)(x,{label:"3.1.1. Norādi",children:(0,a.jsx)("input",{value:null!=E?E:"",onChange:eN(O),placeholder:"NI tips",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})]})]}),4===k&&(0,a.jsxs)(C,{title:"4. Kas notika ar nekustamo īpašumu?",children:[(0,a.jsx)(x,{label:"Notikuma veids",children:(0,a.jsxs)("select",{value:J,onChange:e=>P(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— Izvēlies —"}),s.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),"Cits"===J&&(0,a.jsx)(x,{label:"4.1. Norādi",children:(0,a.jsx)("input",{value:null!=K?K:"",onChange:eN(V),placeholder:"Notikuma apraksts",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})]}),5===k&&(0,a.jsx)(C,{title:"5. Elektrības traucējumi",children:(0,a.jsxs)(x,{label:"Elektrības traucējumi",children:[(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"el",checked:"Jā"===W,onChange:()=>q("Jā")})," Ir"]}),(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"radio",name:"el",checked:"Nē"===W,onChange:()=>q("Nē")})," Nav"]})]})}),6===k&&(0,a.jsx)(C,{title:"6. Vai nepieciešama žāvēšana?",children:(0,a.jsx)(x,{label:"Žāvēšana",children:c.map(e=>(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"dry",checked:G===e,onChange:()=>H(e)})," ",e]},e))})}),7===k&&(0,a.jsx)(C,{title:"7. Vai bojāts kopīpašums?",children:(0,a.jsx)(x,{label:"Kopīpašums",children:c.map(e=>(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"common",checked:X===e,onChange:()=>Y(e)})," ",e]},e))})}),8===k&&(0,a.jsxs)(C,{title:"8. Zaudējuma novērtējums pēc klienta vārdiem",children:[(0,a.jsx)(x,{label:"Vai ir zināma summa?",children:c.map(e=>(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"loss",checked:Z===e,onChange:()=>Q(e)})," ",e]},e))}),"Jā"===Z&&(0,a.jsx)(x,{label:"Summa EUR",children:(0,a.jsx)("input",{type:"number",inputMode:"decimal",step:"0.01",value:null!=$?$:"",onChange:eR(ee),autoComplete:"off",style:{width:200,border:"1px solid #e5e7eb",borderRadius:10,padding:8},placeholder:"€ summa"})})]}),9===k&&(0,a.jsx)(C,{title:"9. Izvēlies telpu/as, kas tika bojātas",children:(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))",gap:12},children:d.map(e=>{var t;return(0,a.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[(0,a.jsxs)("label",{style:{fontWeight:600,display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"checkbox",checked:et[e].checked,onChange:t=>el({...et,[e]:{...et[e],checked:t.target.checked}})}),e]}),et[e].checked&&(0,a.jsxs)("div",{style:{marginTop:8},children:["Cits"===e&&(0,a.jsx)("input",{value:String(null!=(t=et[e].custom)?t:""),onChange:t=>el({...et,[e]:{...et[e],custom:t.currentTarget.value}}),placeholder:"Telpas nosaukums",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,marginBottom:8}}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{children:"Daudzums:"}),(0,a.jsx)("input",{type:"number",min:1,value:et[e].count,onChange:t=>el({...et,[e]:{...et[e],count:Math.max(1,Number(t.target.value||1))}}),style:{width:90,border:"1px solid #e5e7eb",borderRadius:10,padding:6}})]})]})]},e)})})}),10===k&&(0,a.jsxs)(C,{title:"10. Izvēlētās telpas",children:[0===ea.length?(0,a.jsx)("div",{style:{color:"#6b7280"},children:"Nav izvēlētas telpas 9. solī."}):(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))",gap:12},children:ea.map(e=>{let t=(ei[e.id]||[]).filter(e=>e.itemUid&&e.quantity).length,l=(e.id,[]);return(0,a.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#f9fafb"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:6},children:[(0,a.jsxs)("div",{style:{fontWeight:700},children:[e.type," ",e.index]}),(0,a.jsx)("button",{type:"button",onClick:()=>(function(e){let[t,l]=String(e).split("-"),a=parseInt(l,10)||1;er(e=>{var l,n;let i={...e},r=(null==(l=et[t])?void 0:l.checked)?Number((null==(n=et[t])?void 0:n.count)||1):0;if(r<=0)return i;for(let e=a+1;e<=r;e++){let l="".concat(t,"-").concat(e),a="".concat(t,"-").concat(e-1);i[l]&&(i[a]=i[l])}return delete i["".concat(t,"-").concat(r)],i}),el(e=>{let l=e[t];if(!l)return e;let a=(Number(l.count)||1)-1,n={...e};return a<=0?n[t]={...l,checked:!1,count:1}:n[t]={...l,checked:!0,count:a},n}),es(t=>t===e?null:t)})(e.id),title:"Dzēst telpu",style:{marginLeft:"auto",padding:"4px 8px",borderRadius:8,border:"1px solid #e5e7eb",background:"white"},children:"Dzēst"})]}),(0,a.jsxs)("div",{style:{fontSize:13,color:"#4b5563",marginBottom:8},children:["Pozīcijas: ",t]}),l.length>0&&(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:8},children:l.map(e=>(0,a.jsx)("span",{style:{background:"#e5e7eb",borderRadius:999,padding:"4px 10px",fontSize:12},children:e},e))}),(0,a.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,a.jsx)("button",{type:"button",onClick:()=>{es(e.id),w(11)},style:{padding:"8px 12px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Atvērt"})})]},e.id)})}),ea.length>0&&(0,a.jsxs)("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("button",{type:"button",onClick:()=>w(9),style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:"+ Pievienot vēl telpu"}),ea.every(e=>(ei[e.id]||[]).some(e=>e.itemUid&&e.quantity))&&(0,a.jsx)("button",{type:"button",onClick:eS,style:{padding:"12px 16px",borderRadius:12,background:"#059669",color:"white",border:0},children:"Viss pabeigts — izveidot tāmi"})]})]}),11===k&&eo&&(0,a.jsxs)(C,{title:"11. Pozīcijas un apjomi – ".concat(null==(e=ea.find(e=>e.id===eo))?void 0:e.type," ").concat(null==(t=ea.find(e=>e.id===eo))?void 0:t.index),children:[(0,a.jsx)(x,{label:"Piezīmes",children:(0,a.jsx)("input",{value:null!=(j=null==(y=ea.find(e=>e.id===eo))?void 0:y.note)?j:"",onChange:e=>{var t;return t=e.target.value,void en(e=>e.map(e=>e.id===eo?{...e,note:t}:e))},placeholder:"Papildus informācija",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})}),(0,a.jsx)("div",{style:{fontWeight:700,margin:"12px 0 6px"},children:"Pozīcijas un apjomi"}),(ei[eo]||[{category:"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]).map((e,t)=>{var l,n,i;return(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1.1fr 2.2fr 1fr 0.8fr auto",gap:8,alignItems:"end",marginBottom:8},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Kategorija"}),(0,a.jsxs)("select",{value:null!=(l=e.category)?l:"",onChange:e=>{var l;return l=e.target.value,void er(e=>{let a=[...e[eo]||[]];return a[t]={...a[t],category:l,itemUid:"",itemId:"",itemName:"",unit:"",unit_price:null,labor:0,materials:0,mechanisms:0},{...e,[eo]:a}})},style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— visas —"}),ev.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Pozīcija"}),(0,a.jsxs)("select",{value:null!=(n=e.itemUid)?n:"",onChange:e=>(function(e,t,l){let a=ec.find(e=>e.uid===l);er(l=>{let n=[...l[e]||[]];if(a){var i,r,o,s;n[t]={...n[t],category:a.category||n[t].category||"",itemUid:a.uid,itemId:a.id,itemName:a.name,unit:a.unit||"",unit_price:null!=(i=a.unit_price)?i:null,labor:null!=(r=a.labor)?r:0,materials:null!=(o=a.materials)?o:0,mechanisms:null!=(s=a.mechanisms)?s:0}}else n[t]={...n[t],itemUid:"",itemId:"",itemName:"",unit:"",unit_price:null,labor:0,materials:0,mechanisms:0};return{...l,[e]:n}})})(eo,t,e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— izvēlies pozīciju —"}),ec.filter(t=>(!e.category||t.category===e.category)&&!f(t)&&!eh.has(t.uid)).map(e=>(0,a.jsxs)("option",{value:e.uid,children:[e.subcategory?"[".concat(e.subcategory,"] "):"",e.name," \xb7 ",e.unit||"—"]},e.uid))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Mērv."}),(0,a.jsxs)("select",{value:m(e.unit)||"",onChange:e=>ek(eo,t,"unit",m(e.target.value)),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"—"}),ex.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Daudz."}),(0,a.jsx)("input",{type:"number",min:0,step:"0.01",value:null!=(i=e.quantity)?i:"",onChange:e=>ek(eo,t,"quantity",e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8},autoComplete:"off",placeholder:"Skaitlis"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"flex-end"},children:[(0,a.jsx)("button",{type:"button",onClick:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";er(l=>({...l,[e]:[...l[e]||[],{category:t||"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]}))})(eo,e.category||""),style:{padding:"8px 12px",borderRadius:10,background:"#111827",color:"white",border:0},children:"+ Rinda"}),(0,a.jsx)("button",{type:"button",onClick:()=>{er(e=>{let l=e[eo]||[];return l.length<=1?e:{...e,[eo]:l.filter((e,l)=>l!==t)}})},style:{padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:"Dzēst"}),(0,a.jsx)("button",{type:"button",onClick:()=>{es(null),w(9)},style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:"white",color:"#111827"},children:"+ Pievienot vēl telpu"})]})]},t)}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:(0,a.jsx)("button",{type:"button",onClick:()=>{es(null),w(10)},style:{padding:"10px 14px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Saglabāt un atgriezties"})})]}),[1,2,3,4,5,6,7,8,9,12].includes(k)&&(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:16},children:[(0,a.jsx)("button",{type:"button",onClick:()=>w(e=>Math.max(1,e-1)),disabled:1===k,style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:1===k?"#f3f4f6":"white",color:"#111827"},children:"← Atpakaļ"}),(0,a.jsx)("button",{type:"button",onClick:()=>w(e=>Math.min(12,e+1)),disabled:!ew||12===k,style:{padding:"10px 14px",borderRadius:10,background:ew&&12!==k?"#111827":"#9ca3af",color:"white",border:0},children:12===k?"Beigas":"Tālāk →"})]}),(0,a.jsxs)("div",{style:{background:"white",padding:16,borderRadius:12,marginTop:20},children:[(0,a.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Saglabātās tāmēs (šajā pārlūkā)"}),0===eC.length?(0,a.jsx)("div",{style:{color:"#6b7280"},children:"Vēl nav saglabātu tāmju."}):(0,a.jsx)("div",{style:{overflowX:"auto"},children:(0,a.jsxs)("table",{style:{width:"100%",fontSize:14},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{style:{textAlign:"left",borderBottom:"1px solid #e5e7eb"},children:[(0,a.jsx)("th",{style:{padding:"8px 12px"},children:"Fails"}),(0,a.jsx)("th",{style:{padding:"8px 12px"},children:"Tāmētājs"}),(0,a.jsx)("th",{style:{padding:"8px 12px"},children:"Datums"})]})}),(0,a.jsx)("tbody",{children:eC.map(e=>(0,a.jsxs)("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[(0,a.jsx)("td",{style:{padding:"8px 12px",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace"},children:e.filename}),(0,a.jsx)("td",{style:{padding:"8px 12px"},children:e.estimator}),(0,a.jsx)("td",{style:{padding:"8px 12px"},children:new Date(e.createdAtISO).toLocaleString()})]},e.id))})]})})]}),(0,a.jsx)("footer",{style:{paddingBottom:40,marginTop:12,fontSize:12,color:"#6b7280"},children:"Piezīme: forma nerāda apakšpozīcijas; Excel tās pievieno automātiski. Ja kādai vecākai pozīcijai nav saites uz apakšpozīcijām JSON datnē, tiek izmantoti nosaukumu HINTI (skat. kodu)."})]})})}}}]);