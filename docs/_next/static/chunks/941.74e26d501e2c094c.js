"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[941],{2941:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var n=a(7876),l=a(4232),i=a(8230),r=a.n(i);let o=["Swedbank","Gjensidige","Compensa","IF","BTA","Balta"],s=["Komerctelpa","Dzīvojamā ēka"],c=["Privātmāja","Daudzdzīvokļu māja","Rindu māja","Cits"],u=["CTA","Plūdi","Uguns","Koks","Cits"],d=["Virtuve","Guļamistaba","Koridors","Katla telpa","Dzīvojamā istaba","Vannas istaba","Tualete","Garderobe","Cits"],m=["labor","darbs"],p=["materials","materiāli","materiali","materjali","materiālu izmaksas","materialu izmaksas","mater.","mater","materiāli (eur)","materiāli eur"],g=["mechanisms","mehānismi","mehanismi","mehānismu","meh","meh izmaksas","mehizmaksas","mehānismu izmaksas","mehānismi (eur)","mehānismi eur"],h=["unit_price","unitprice","vienības cena","vienibas cena","cena","vienc","vienības cena eur"],f=["m2","m3","m","gab","kpl","diena","obj","c/h"],b=["Griesti","Sienas, ailes","Grīdas","Citi apdares darbi","Jumts","Fasāde","Citi darbi un izmaksas","Telpu kopšana","Būvgružu utilizācija"],v=new Set(["Griesti","Sienas, ailes","Sienas"]),y={Griesti:{"Krāsots betons":["Krāsojums (ar špaktelējumu)","Griestu attīrīšana no esošā seguma","Griestu gruntēšana, špahtelēšana un slīpēšana","Griestu krāsošana ar emulsijas krāsu"],"Krāsots ģipškartons":["Ģipškartona konstrukcija (parastais ģipškartons)","Griestu attīrīšana no esošā seguma","Ģipškartona un metāla karkasa demontāža","Piekārto reģipšu griestu metāla karkasa ierīkošana","Karkasa apšūšana ar ģipškartonu un šuvju apstrāde","Griestu gruntēšana, špahtelēšana un slīpēšana","Griestu krāsošana ar emulsijas krāsu"],"Ģipškartons un krāsojamās tapetes vai tapetes":{krasojamas:["Ģipškartona konstrukcija (parastais ģipškartons)","Griestu attīrīšana no esošā seguma","Ģipškartona un metāla karkasa demontāža","Piekārto reģipšu griestu metāla karkasa ierīkošana","Karkasa apšūšana ar ģipškartonu un šuvju apstrāde","Griestu gruntēšana, špahtelēšana un slīpēšana","Krāsojamās tapetes","Griestu gruntēšana pirms tapešu līmēšanas","Tapešu līmēšana","Griestu krāsošana ar emulsijas krāsu"],tapetes:["Tapetes","Griestu attīrīšana no esošā seguma","Griestu gruntēšana","Tapešu līmēšana"]}},"Sienas, ailes":{"Krāsots betons":["Sienu attīrīšana no esošā seguma","Sienu gruntēšana, špahtelēšana un slīpēšana","Sienu krāsošana ar emulsijas krāsu"],"Krāsots ģipškartons":["Sienu attīrīšana no esošā seguma","Ģipškartona un metāla karkasa demontāža","Piekārto reģipšu griestu metāla karkasa ierīkošana","Karkasa apšūšana ar ģipškartonu un šuvju apstrāde","Sienu gruntēšana, špahtelēšana un slīpēšana","Sienu krāsošana ar emulsijas krāsu"],"Ģipškartons un krāsojamās tapetes vai tapetes":{krasojamas:["Sienu attīrīšana no esošā seguma","Ģipškartona un metāla karkasa demontāža","Piekārto reģipšu griestu metāla karkasa ierīkošana","Karkasa apšūšana ar ģipškartonu un šuvju apstrāde","Sienu gruntēšana, špahtelēšana un slīpēšana","Sienu gruntēšana pirms tapešu līmēšanas","Tapešu līmēšana","Sienu krāsošana ar emulsijas krāsu"],tapetes:["Sienu attīrīšana no esošā seguma","Sienu gruntēšana pirms tapešu līmēšanas","Tapešu līmēšana"]}}};function k(e){if(!e)return"";let t=String(e).trim().toLowerCase().replace("\xb2","2").replace("\xa0"," ").replace(/\s{2,}/g," ");return["gb.","gab.","gab"].includes(t)?"gab":["m2","m 2","m^2"].includes(t)?"m2":["m3","m 3","m^3"].includes(t)?"m3":"m"===t?"m":["kpl","kpl."].includes(t)?"kpl":"diena"===t?"diena":"c/h"===t?"c/h":["obj.","obj"].includes(t)?"obj":/^\d+\s*gb\.$/.test(t)?"gab":t}function j(e){if(null==e||""===e)return 0;let t=parseFloat(String(e).replace(/\s+/g,"").replace(",","."));return Number.isFinite(t)?t:0}function x(e){var t,a,n,l;if(!e)return!1;let i=(e.name||"").trim();if(!i)return!1;let r=k(e.unit||""),o=j(null!=(t=e.labor)?t:0)+j(null!=(a=e.materials)?a:0)+j(null!=(n=e.mechanisms)?n:0)+j(null!=(l=e.unit_price)?l:0);if(!((!r||"nan"===r||"-"===r)&&0===o))return!1;let s=i.toLowerCase();return!["transports","tiešās izmaksas kopā","tiesas izmaksas kopa","virsizdevumi","virsizdevumi","peļņa","pelna","sociālais nodoklis","socialais nodoklis","kopā","pvn","sastādīja","sastadija",'sia "lv group"',"sert."].some(e=>s.includes(e))}function C(e,t){if(!e||"object"!=typeof e)return 0;let a=e=>String(null!=e?e:"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(RegExp("[^\\p{L}\\p{N}]+","gu"),"").trim(),n=Object.entries(e).map(e=>{let[t,n]=e;return[a(t),n]}),l=t.map(a);for(let[e,t]of n)if(l.includes(e)){let e=j(t);if(Number.isFinite(e))return e}let i=l.flatMap(e=>e.includes("labor")||e.includes("darbs")?["labor","darbs"]:e.includes("material")?["material","materiali","mater"]:e.includes("mechanism")||e.includes("meh")?["mechanism","meh"]:e.includes("cena")||e.includes("unitprice")?["cena","unitprice"]:[e]);for(let[e,t]of n)if(i.some(t=>e.includes(t))){let e=j(t);if(Number.isFinite(e))return e}return 0}let w=e=>String(null!=e?e:"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(RegExp("[^\\p{L}\\p{N}]+","gu")," ").replace(/\s+/g," ").trim(),S=new Set([w("Ģipškartona konstrukcija"),w("Griestu sagatavošanas darbi"),w("Balsinājums"),w("Balinājums")]);function N(e){return String(null!=e?e:"").normalize("NFD").replace(RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[.,;:()\[\]{}]/g," ").replace(/\s+/g," ").trim()}function A(e){return!0===e||1===e||"1"===e||"string"==typeof e&&["true","yes","y","jā"].includes(e.trim().toLowerCase())}function z(e){return A(e.is_child)||A(e.child)||!!e.parent_uid||!!e.parentUid||!!e.parent_id||!!e.parentId||!!e.parent||!!e.parent_name||!!e.parentName||!!e.childOf||!!e.parentKey||!!e.parent_key}function _(e,t){var a,n,l,i,r,o;let s=Number(null!=(a=null==e?void 0:e.labor)?a:0)||0,c=Number(null!=(n=null==e?void 0:e.mechanisms)?n:0)||0,u=Number(null!=(l=null==e?void 0:e.unit_price)?l:0)||0,d=Number(null!=(i=null==e?void 0:e.materials)?i:s||c?0:u)||0;return{name:(null==e?void 0:e.name)||"",unit:k((null==e?void 0:e.unit)||t||""),coeff:Number(null!=(o=null!=(r=null==e?void 0:e.coeff)?r:null==e?void 0:e.multiplier)?o:1)||1,labor:s,materials:d,mechanisms:c,unit_price_raw:u}}function K(e){for(let t of["children","komponentes","apaks","apakšpozīcijas","components","componentes","subitems","sub_items","items","pozicijas","pozīcijas"])if(Array.isArray(e[t]))return e[t];for(let[t,a]of Object.entries(e))if(Array.isArray(a)&&a.some(e=>e&&"object"==typeof e&&(e.name||e.title)))return a;return[]}function R(e,t,a){let n=w(e),l=w(t),i=a.find(e=>w(e.name)===n&&w(e.category)===l);return i||(i=a.find(e=>w(e.name)===n))||(i=a.find(e=>w(e.category)===l&&w(e.name).includes(n)))?i:(i=a.find(e=>w(e.name).includes(n)))||null}let I=l.memo(function(e){let{label:t,children:a}=e;return(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("div",{style:{fontWeight:600,marginBottom:6},children:t}),(0,n.jsx)("div",{children:a})]})}),B=l.memo(function(e){let{title:t,children:a}=e;return(0,n.jsxs)("div",{style:{background:"white",padding:16,borderRadius:12,boxShadow:"0 1px 4px rgba(0,0,0,0.06)"},children:[(0,n.jsx)("div",{style:{fontSize:18,fontWeight:700,marginBottom:10},children:t}),a]})});function T(e){var t,i,A,T;let{onBackToList:D}=e,[M,E]=(0,l.useState)(1),F=(0,l.useMemo)(()=>{var e;let t=!!(null==(e=window.__NEXT_DATA__)?void 0:e.assetPrefix),a=window.location.pathname.startsWith("/eksperti");return t||a?"/eksperti":""},[]),[P,U]=(0,l.useState)(""),[L,G]=(0,l.useState)(null),J=l.useCallback(e=>{try{let t=(e=>{let t=(null==e?void 0:e.email)||(null==e?void 0:e.id)||(null==e?void 0:e.fullName)||"anonymous";return"eksperti_tames_".concat(t)})(L),a=localStorage.getItem(t),n=a?JSON.parse(a):[],l=[e,...n].slice(0,50);localStorage.setItem(t,JSON.stringify(l))}catch(e){console.error("Neizdevās saglabāt tāmi:",e)}},[L]),[O,V]=(0,l.useState)(""),[W,H]=(0,l.useState)("Balta"),[q,Y]=(0,l.useState)(""),[Z,$]=(0,l.useState)(""),[X,Q]=(0,l.useState)(""),[ee,et]=(0,l.useState)(""),[ea,en]=(0,l.useState)(""),[el,ei]=(0,l.useState)("Nē"),[er,eo]=(0,l.useState)("Nē"),[es,ec]=(0,l.useState)("Nē"),[eu,ed]=(0,l.useState)("Nē"),[em,ep]=(0,l.useState)(""),[eg,eh]=(0,l.useState)(d.reduce((e,t)=>(e[t]={checked:!1,count:1,custom:""},e),{})),[ef,eb]=(0,l.useState)([]),[ev,ey]=(0,l.useState)({}),[ek,ej]=(0,l.useState)(null),[ex,eC]=(0,l.useState)([]),ew=(0,l.useMemo)(()=>{let e=new Set(f);for(let t of ex){let a=k((null==t?void 0:t.unit)||"");a&&e.add(a)}return Array.from(e)},[ex]),[eS,eN]=(0,l.useState)(""),[eA,ez]=(0,l.useState)(new Map),[e_,eK]=(0,l.useState)(new Map),[eR,eI]=(0,l.useState)(new Map),[eB,eT]=(0,l.useState)(""),[eD,eM]=(0,l.useState)(""),[eE,eF]=(0,l.useState)(null);(0,l.useMemo)(()=>{let e=new Map;for(let t of ex)e.set(String(t.id),t);return e},[ex]),(0,l.useMemo)(()=>{let e=new Map;for(let t of ex){let a=w(t.name);a&&e.set(a,t)}return e},[ex]),(0,l.useMemo)(()=>{let e=new Map;for(let t of ex){let a="".concat(w(t.category),"||").concat(w(t.name));a&&e.set(a,t)}return e},[ex]);let[eP,eU]=(0,l.useState)({}),[eL,eG]=(0,l.useState)(null),[eJ,eO]=(0,l.useState)(null),[eV,eW]=(0,l.useState)(null),[eH,eq]=(0,l.useState)(null),[eY,eZ]=(0,l.useState)("");(0,l.useEffect)(()=>{try{let e=localStorage.getItem("eksperti_user");if(e){let t=JSON.parse(e);G(t)}}catch(e){console.warn("Neizdevās nolasīt ielogoto lietotāju:",e)}},[]),(0,l.useEffect)(()=>{let e=!1;return(async()=>{try{let t="".concat(F,"/prices/child_hints.json");"Gjensidige"===W?t="".concat(F,"/prices/gjensidige_child_hints.json"):"Swedbank"===W&&(t="".concat(F,"/prices/swedbank_child_hints.json"));let a=await fetch(t,{cache:"no-store"});if(!a.ok)return;let n=await a.json();if(e||!n)return;let l={},i=e=>w(e);if("Swedbank"===W&&Array.isArray(n))for(let e of n){let t=null==e?void 0:e.parent_uid,a=null==e?void 0:e.child_names;t&&Array.isArray(a)&&(l[i(t)]=a)}else if("object"==typeof n)for(let[e,t]of Object.entries(n))l[i(e)]=Array.isArray(t)?t:[];eU(l)}catch(e){}})(),()=>{e=!0}},[F,W]),(0,l.useEffect)(()=>{window.__PC=ex},[ex]),(0,l.useEffect)(()=>{window.dumpPC=()=>{let e=window.__PC||[];return{rows:e.length,withMaterials:e.filter(e=>(e.materials||0)>0).length,withMechanisms:e.filter(e=>(e.mechanisms||0)>0).length,sample:e.slice(0,3)}}},[]),(0,l.useEffect)(()=>{if(!["Balta","Gjensidige","Swedbank"].includes(W)){ez(new Map),eK(new Map),eI(new Map),eC([]);return}eN(""),(async()=>{try{let e=async e=>{let t=await fetch(e,{cache:"no-store"});if(!t.ok)throw Error("".concat(t.status," ").concat(t.statusText));let a=await t.json();return Array.isArray(a)?a:Array.isArray(a.items)?a.items:[]},t=[],a="";if("Balta"===W){try{t=await e("".concat(F,"/prices/balta.v2.json")),a="balta.v2.json"}catch(e){}if(!t.length)try{t=await e("".concat(F,"/prices/balta.json")),a="balta.json"}catch(e){eN("Neizdevās ielādēt BALTA cenas: ".concat(e.message));return}}else if("Gjensidige"===W)try{let n=await e("".concat(F,"/prices/gjensidige.json"));if(!Array.isArray(n)||!n.length)return void eN("Neizdevās ielādēt GJENSIDIGE cenrādi (gjensidige.json ir tukšs vai bojāts).");let l=e=>{let t=j(e);return Number.isFinite(t)?t:0},i=n.filter(e=>e&&(e.name||e.Nosaukums)).map((e,t)=>{var a,n,i,r,o,s,c,u,d,m,p,g,h,f,b,v,y,j,x,C,w;let S=String(null!=(n=null!=(a=e.name)?a:e.Nosaukums)?n:"").trim(),N=String(null!=(r=null!=(i=e.category)?i:e.Kategorija)?r:"").trim(),A=String(null!=(c=null!=(s=null!=(o=e.subcategory)?o:e.Apakkategorija)?s:e["Apakškategorija"])?c:"").trim(),z=k(null!=(m=null!=(d=null!=(u=e.unit)?u:e["Mērv."])?d:e.Merv)?m:""),_=String(null!=(p=e.id)?p:t),K=String(null!=(g=e.uid)?g:[N,A,_,S].join("::"));return{id:_,uid:K,name:S,category:N,subcategory:A,unit:z,unit_price:l(null!=(f=null!=(h=e.unit_price)?h:e["Vienības cena"])?f:e.cena),labor:l(null!=(b=e.labor)?b:e.Darbs),materials:l(null!=(y=null!=(v=e.materials)?v:e.Materiāli)?y:e["Materiāli.1"]),mechanisms:l(null!=(C=null!=(x=null!=(j=e.mechanisms)?j:e["Mehā-nismi"])?x:e.Mehanismi)?C:e["Mehā-nismi.1"]),is_child:!!(e.is_child||e.parent_uid),parent_uid:e.parent_uid||null,coeff:l(null!=(w=e.coeff)?w:1)||1}}),r="";t=i=i.map(e=>{if(x(e))return r=(e.name||"").trim(),{...e,category:r};let t=(e.category||r||"").trim();return{...e,category:t}}),a="gjensidige.json"}catch(e){eN("Neizdevās ielādēt GJENSIDIGE cenrādi: ".concat(e.message));return}else if("Swedbank"===W)try{if(t=await e("".concat(F,"/prices/swedbank.json")),!Array.isArray(t)||!t.length)return void eN("Neizdevās ielādēt SWEDBANK cenrādi (swedbank.json ir tukšs vai bojāts).");a="swedbank.json"}catch(e){eN("Neizdevās ielādēt SWEDBANK cenrādi: ".concat(e.message));return}let n=[],l=[],i=[];if(t.forEach((e,t)=>{var a,r,o;let s=(e.category||"").trim(),c=(e.subcategory||e.subcat||e.group||e.grupa||e["apakškategorija"]||"").trim(),u=String(null!=(a=e.id)?a:t),d=(e.name||"").trim(),f=String(e.uid||[s,c,u,d].join("::")),b=e.parent_uid||e.parentUid||e.parent_id||e.parentId||e.parent||e.parent_name||e.parentName||e.childOf||null,v=!!b,y={id:u,uid:f,name:d,category:s,subcategory:c,unit:k(e.unit),unit_price:C(e,h),labor:C(e,m),materials:C(e,p),mechanisms:C(e,g),is_child:v,parent_uid:b||null,is_section:!!e.is_section};if(v){let t={...y,coeff:j(null!=(o=null!=(r=e.coeff)?r:e.multiplier)?o:1)||1};l.push(t),i.push(t)}else{let t={...y,is_child:!1,parent_uid:null};n.push(t),i.push(t);let a=Array.isArray(e.children)&&e.children||Array.isArray(e.komponentes)&&e.komponentes||Array.isArray(e.apaks)&&e.apaks||Array.isArray(e["apakšpozīcijas"])&&e["apakšpozīcijas"]||[];a.length&&(t.children=[],a.forEach((a,n)=>{var r,o;let d=(a.name||a.title||"").trim();if(!d)return;let b={id:"".concat(u,"-c").concat(n),uid:[s,c,"".concat(u,"-c").concat(n),d].join("::"),name:d,category:s,subcategory:c,unit:k(a.unit||e.unit),unit_price:C(a,h),labor:C(a,m),materials:C(a,p),mechanisms:C(a,g),is_child:!0,parent_uid:f,coeff:j(null!=(o=null!=(r=a.coeff)?r:a.multiplier)?o:1)||1,is_section:!1};l.push(b),i.push(b),t.children.push({name:b.name,unit:b.unit,coeff:b.coeff||1,labor:b.labor||0,materials:b.materials||0,mechanisms:b.mechanisms||0})}))}}),"balta.v2.json"===a&&0===l.length)try{let t=await e("".concat(F,"/prices/balta.json"));if(function(e,t){let a=new Map,n=new Map,l=(e,t)=>"".concat(String(e||"").trim().toLowerCase(),"|").concat(String(t||"").trim().toLowerCase());for(let e of t){var i;if(!K(e).length)continue;let t=String(null!=(i=e.id)?i:"");t&&a.set(t,e),n.set(l(e.category,e.name),e)}let r=0;for(let t of e){let e=a.get(String(t.id)),i=n.get(l(t.category,t.name)),o=e||i;if(!o)continue;let s=K(o);s.length&&(t.children=s.map(e=>{var a,n;return{name:(e.name||e.title||"").trim(),unit:k(e.unit||o.unit||t.unit||""),coeff:j(null!=(n=null!=(a=e.coeff)?a:e.multiplier)?n:1)||1,labor:C(e,m),materials:C(e,p),mechanisms:C(e,g),unit_price:C(e,h)}}).filter(e=>e.name),t.children.length&&r++)}return r}(n,t)>0)for(let e of n)Array.isArray(e.children)&&e.children.length&&e.children.forEach((t,a)=>{let n={id:"".concat(e.id,"-c").concat(a),uid:[e.category||"",e.subcategory||"","".concat(e.id,"-c").concat(a),t.name].join("::"),name:t.name,category:e.category||"",subcategory:e.subcategory||"",unit:k(t.unit||e.unit),unit_price:Number(t.unit_price||0),labor:Number(t.labor||0),materials:Number(t.materials||0),mechanisms:Number(t.mechanisms||0),is_child:!0,parent_uid:e.uid,coeff:Number(t.coeff||1)||1,is_section:!1};l.push(n),i.push(n)})}catch(e){}let r=new Map,o=null;for(let e of i){if(!e.is_child){o=e;continue}if(o&&e.category===o.category&&e.subcategory===o.subcategory){let t=r.get(o.uid)||[],a=_(e,o.unit);t.some(e=>w(e.name)===w(a.name)&&k(e.unit)===k(a.unit))||t.push(a),r.set(o.uid,t)}}for(let e of n){if(!Array.isArray(e.children)||!e.children.length)continue;let t=r.get(e.uid)||[];for(let a of e.children){let n=_(a,e.unit);t.some(e=>w(e.name)===w(n.name)&&k(e.unit)===k(n.unit))||t.push(n)}t.length&&r.set(e.uid,t)}let s=[...n,...l],c=new Map,u=new Map;for(let e of s){let t=w(e.name),a=w(e.category);c.has(t)||c.set(t,[]),c.get(t).push(e),u.set("".concat(a,"|").concat(t),e)}eC(s),eK(c),eI(u),ez(r),window.__PC=s,console.log("[BALTA] exposed __PC:",{rows:s.length,withMaterials:s.filter(e=>(e.materials||0)>0).length,withMechanisms:s.filter(e=>(e.mechanisms||0)>0).length,children:l.length,adjParents:[...r.keys()].length}),console.log("[BALTA] loaded:",{source:a,full:s.length,parents:n.length,children:l.length,splitParents:n.filter(e=>(e.labor||0)+(e.materials||0)+(e.mechanisms||0)>0).length,splitChildren:l.filter(e=>(e.labor||0)+(e.materials||0)+(e.mechanisms||0)>0).length,adjParents:[...r.keys()].length})}catch(e){eN("Neizdevās ielādēt BALTA cenas: ".concat(e.message))}})()},[W,F]);let e$=(0,l.useMemo)(()=>{let e=new Set;if(!eP||"object"!=typeof eP)return e;for(let t of Object.values(eP))if(Array.isArray(t))for(let a of t){let t="string"==typeof a?a:null==a?void 0:a.name;t&&e.add(w(t))}return e},[eP]),eX=(0,l.useCallback)((e,t)=>{let a=w(e),n=w(t),l="".concat(n,"|").concat(a);if(eR.has(l))return eR.get(l);let i=e_.get(a);if(Array.isArray(i)&&i.length)return i[0];for(let[e,t]of eR.entries()){let[l,i]=e.split("|");if(l===n&&i.includes(a))return t}return null},[e_,eR]),eQ=(0,l.useCallback)(e=>{if(!e)return[];let t=[],a=new Set,n=(e,n)=>{let l=_(e,n),i="".concat(w(null==l?void 0:l.name),"::").concat(k((null==l?void 0:l.unit)||""));l.name&&!a.has(i)&&(a.add(i),t.push(l))};if(Array.isArray(e.children)&&e.children.length)for(let t of e.children)n(t,e.unit);for(let t of ex)z(t)&&function(e,t){let a=new Set([t.uid,t.id,t.name,"".concat(t.category,"::").concat(t.name)].map(N).filter(Boolean));return[e.parent_uid,e.parentUid,e.parent_id,e.parentId,e.parent,e.parent_name,e.parentName,e.childOf,e.parent_key,e.parentKey].map(N).filter(Boolean).some(e=>a.has(e))}(t,e)&&n(t,e.unit);let l=eA.get(e.uid);if(Array.isArray(l)&&l.length)for(let t of l)n(t,e.unit);let i=null;if("Swedbank"===W?i=eP[w(e.uid)]:eP[w(e.name)]||eP[w(e.id)]||eP[w(e.uid)],Array.isArray(i))for(let t of i){let a="string"==typeof t?t:null==t?void 0:t.name;if(!a)continue;let l=Number("object"==typeof t&&(null==t?void 0:t.coeff)?t.coeff:1)||1,i="object"==typeof t&&(null==t?void 0:t.unit)?t.unit:void 0,r=eX(a,e.category)||R(a,e.category,ex);n(r?{...r,unit:i||r.unit||e.unit,coeff:l,labor:C(r,m),materials:C(r,p),mechanisms:C(r,g),unit_price:C(r,h)}:{name:a,unit:i||e.unit,coeff:l,labor:0,materials:0,mechanisms:0,unit_price:0},e.unit)}return t},[ex,eP,eA,eX]),e0=(0,l.useMemo)(()=>{if(!ex.length)return[];if("Swedbank"===W)return b;if("Gjensidige"===W){let e=ex.filter(e=>x(e)).map(e=>(e.name||"").trim()).filter(Boolean);if(e.length)return Array.from(new Set(e))}return Array.from(new Set(ex.map(e=>(e.category||"").trim()).filter(Boolean)))},[ex,W]),[e1,e2]=(0,l.useState)([]);function e8(e,t,a,n){ey(l=>{let i=[...l[e]||[]],r={...i[t],[a]:n};return i[t]=r,{...l,[e]:i}})}function e6(e,t,a,n,l){let i=(a||"").trim();ey(a=>{let r=[...a[e]||[]],o=r[t]||{category:i||"",quantity:"",unit:""},s="SWED_SURFACE::".concat(i,"::").concat(n,"::").concat(l||"");return r[t]={...o,category:i,itemUid:s,itemId:s,itemName:n,unit:o.unit||"m2",unit_price:0,labor:0,materials:0,mechanisms:0,swedSurfacePos:n,swedSurfaceVariant:l||"",swedAuto:!1},{...a,[e]:r}})}(0,l.useEffect)(()=>e2(function(){try{let e=localStorage.getItem("tames_profils_saglabatie");return e?JSON.parse(e):[]}catch(e){return[]}}()),[]),(0,l.useEffect)(()=>{let e=[];Object.entries(eg).forEach(t=>{let[a,n]=t;if(!n.checked)return;let l=Math.max(1,Number(n.count)||1);for(let t=1;t<=l;t++){let l="".concat(a,"-").concat(t),i=ef.find(e=>e.id===l);e.push({id:l,type:"Cits"===a?n.custom||"Cits":a,index:t,note:(null==i?void 0:i.note)||""})}}),eb(e),ey(t=>{let a={};return e.forEach(e=>{a[e.id]=t[e.id]||[{category:"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]}),a})},[eg]);let e3=(0,l.useMemo)(()=>{switch(M){case 1:return!!O.trim();case 2:return!!W;case 3:return!!q&&("Dzīvojamā ēka"!==q||!!Z);case 4:return!!ee&&("Cits"!==ee||!!ea.trim());case 5:return["Jā","Nē"].includes(el);case 6:return["Jā","Nē"].includes(er);case 7:return["Jā","Nē"].includes(es);case 8:if(!eH)return!1;if("Nē"===eH)return!0;return eY&&Number(eY)>0;case 9:return Object.values(eg).some(e=>e.checked);default:return!0}},[M,O,W,q,Z,ee,ea,el,er,es,eH,eY,eg]);function e4(e){let{parentRow:t,qty:a,categoryHint:n,priceCatalog:l,getChildrenFor:i,selections:r,roomLabel:o,depth:s=0,visited:c=new Set}=e;if(t&&!(s>10))for(let e of i(t)||[]){let u=(e.name||"").trim();if(!u)continue;let d="".concat(t.uid||t.name,"->").concat(u,"::").concat(e.unit||"");if(c.has(d))continue;c.add(d);let m=(Number(e.coeff||1)||1)*(Number(a)||0),p=s<=0?u:u.startsWith("-")?" ".concat(u):" - ".concat(u);r.push({isChild:!0,room:o,name:p,unit:e.unit||t.unit||"",qty:m,labor:Number(e.labor||0),materials:Number(e.materials||0),mechanisms:Number(e.mechanisms||0),unitPrice:Number(e.unit_price||e.unitPrice||0),category:n||t.category||"",parentName:t.name||""});let g=l.find(t=>t.uid&&e.uid&&t.uid===e.uid)||l.find(e=>(e.name||"").trim()===u&&(e.category||"").trim()===(n||t.category||"").trim())||l.find(e=>(e.name||"").trim()===u);g&&e4({parentRow:g,qty:m,categoryHint:g.category||n||"",priceCatalog:l,getChildrenFor:i,selections:r,roomLabel:o,depth:s+1,visited:c})}}async function e7(){try{let t=e=>String(e).padStart(2,"0"),n=await a.e(22).then(a.t.bind(a,1980,23)),l=(null==n?void 0:n.default)||n,i="".concat(F,"/templates/balta_template.xlsx"),r=await fetch(i);if(!r.ok)return void alert("Neizdevās ielādēt ".concat(i,". Pārliecinies, ka fails ir public/templates/balta_template.xlsx"));let o=await r.arrayBuffer(),s=new l.Workbook;await s.xlsx.load(o);let c=s.getWorksheet("Tāme")||s.worksheets[0],u=s.addWorksheet("Tāme (izvade)",{views:[{showGridLines:!1}]}),d={name:"Calibri",size:11},f="#,##0.00",b="#,##0.00",v={style:"thin"},x={top:v,left:v,bottom:v,right:v},w={type:"pattern",pattern:"solid",fgColor:{argb:"FFF3F6FD"}},S={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFEFEF"}},N=new Date,A="".concat(N.getFullYear()).concat(t(N.getMonth()+1)).concat(t(N.getDate())),z="",_=(z="Swedbank"===W?"S":"Balta"===W?"B":"")?"".concat(z,"-").concat(A):A,K="";K="Swedbank"===W||"Balta"===W?"LOKĀLĀ TĀME NR.".concat(_):"TĀMES NR.: ".concat(_);let I=N.toLocaleDateString("lv-LV",{year:"numeric",month:"long",day:"numeric"}),B="".concat(W||"Tame","_").concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e=>String(e).padStart(2,"0");return"".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate()),"_").concat(t(e.getHours()),"-").concat(t(e.getMinutes()))}()),T=window.prompt("Norādi tāmes nosaukumu (piemēram, 'Virtuve griesti 3. stāvs'):",B);if(null===T)return;let D=(T=T.trim()||B).normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_\-]+/g,"_");u.getCell("A1").value="Pasūtītājs: ".concat(W||"Balta"),u.getCell("A2").value="Objekts: ".concat(q||"").concat(Z?" – "+Z:""),u.getCell("A3").value="Objekta adrese: ".concat(O||""),u.getCell("A8").value="Rīga, ".concat(I),u.getCell("A9").value="Pamatojums: apdrošināšanas lieta Nr. ".concat(P||"—"),u.getCell("J1").value="LV GROUP SIA",u.getCell("J2").value="Reģ. Nr.: LV40103160668",u.mergeCells(6,2,6,12);let M=u.getCell(6,2);M.value=K,M.font={...d,size:16,bold:!0},M.alignment={horizontal:"center",vertical:"middle"};let U=[];if(ef.forEach(e=>{(ev[e.id]||[]).forEach(t=>{var a,n,l,i,r,o,s,c,u;let d=j(t.quantity);if(!d)return;if("Swedbank"===W&&String(t.itemUid||"").startsWith("SWED_SURFACE::")){let n=j(t.quantity);if(!n)return;let l=String(t.itemUid).split("::"),i=l[1]||"",r=l[2]||"",o=l[3]||"";U.push({isChild:!1,room:"".concat(e.type," ").concat(e.index),name:"".concat(r)+(o?" \xb7 ".concat(o):""),category:i,unit:k(t.unit||"m2"),qty:n,labor:0,materials:0,mechanisms:0,unitPrice:0});let s=null==y||null==(a=y[i])?void 0:a[r];if(s&&"object"==typeof s&&!Array.isArray(s)&&(s="tapetes"===o?s.tapetes:s.krasojamas),Array.isArray(s))for(let a of s){let l=R(a,i,ex);if(!l)continue;let r=C(l,m),o=C(l,p),s=C(l,g),c=r+o+s||C(l,h);U.push({isChild:!1,room:"".concat(e.type," ").concat(e.index),name:l.name,unit:k(l.unit||t.unit||"m2"),qty:n,labor:r,materials:o,mechanisms:s,unitPrice:c}),e4({parentRow:l,qty:n,categoryHint:i,priceCatalog:ex,getChildrenFor:eQ,findRowByNameFuzzy:R,normalizeUnit:k,pickNum:C,LABOR_KEYS:m,MATERIAL_KEYS:p,MECHANISM_KEYS:g,UNIT_PRICE_KEYS:h,selections:U,roomLabel:"".concat(e.type," ").concat(e.index),depth:1})}return}let f=ex.find(e=>e.uid===t.itemUid)||ex.find(e=>e.id===t.itemId);if(!f)return;let b=k(t.unit||f.unit||""),v=j(null!=(l=null!=(n=t.labor)?n:f.labor)?l:0),x=j(null!=(r=null!=(i=t.materials)?i:f.materials)?r:0),w=j(null!=(s=null!=(o=t.mechanisms)?o:f.mechanisms)?s:0),S=v+x+w||j(null!=(u=null!=(c=t.unit_price)?c:f.unit_price)?u:0);U.push({isChild:!1,room:"".concat(e.type," ").concat(e.index),category:f.category||t.category||"",name:t.itemName||f.name||"",unit:b,qty:d,labor:v,materials:x,mechanisms:w,unitPrice:S}),e4({parentRow:f,qty:d,categoryHint:f.category||t.category||"",priceCatalog:ex,getChildrenFor:eQ,selections:U,roomLabel:"".concat(e.type," ").concat(e.index)})})}),!U.length)return void alert("Nav nevienas pozīcijas ar daudzumu.");for(let e of(u.getCell(13,1).value="Darbu nosaukums",u.getCell(13,2).value="Mērv.",u.getCell(13,3).value="Daudz.",u.mergeCells(13,4,13,7),u.getCell(13,4).value="Vienības cena, EUR",u.mergeCells(13,8,13,11),u.getCell(13,8).value="Summa, EUR",u.getCell(14,4).value="Darbs",u.getCell(14,5).value="Materiāli",u.getCell(14,6).value="Mehānismi",u.getCell(14,7).value="Cena",u.getCell(14,8).value="Darbs",u.getCell(14,9).value="Materiāli",u.getCell(14,10).value="Mehānismi",u.getCell(14,11).value="Kopā",[13,14])){let t=u.getRow(e);for(let e=1;e<=11;e++){let a=t.getCell(e);a.font={...d,bold:!0},a.alignment={horizontal:"center",vertical:"middle",wrapText:!0},a.fill=S,a.border=x}t.height=22}let G=15,V=null,H=null,Y=new Map;for(let[e,t]of(U.forEach(e=>{Y.has(e.room)||Y.set(e.room,[]),Y.get(e.room).push(e)}),Y.entries())){u.mergeCells(G,1,G,11);let a=u.getCell(G,1);for(let n of(a.value=e,a.fill=w,a.font={...d,bold:!0},a.alignment={wrapText:!0,vertical:"middle"},a.border={bottom:v},u.getRow(G).height=18,G++,t)){let e=u.getRow(G);e.getCell(1).value=n.isChild?"    ".concat(n.name):n.name,e.getCell(2).value=n.unit,e.getCell(3).value=n.qty;let t=Number(n.labor||0),a=Number(n.materials||0),l=Number(n.mechanisms||0);if(t+a+l>0)u.getCell(G,4).value=t,u.getCell(G,5).value=a,u.getCell(G,6).value=l;else{let e=Number(n.unitPrice||0);u.getCell(G,4).value=0,u.getCell(G,5).value=e,u.getCell(G,6).value=0}for(let t of(u.getCell(G,7).value={formula:"ROUND(SUM(D".concat(G,":F").concat(G,"),2)")},u.getCell(G,8).value={formula:"ROUND(D".concat(G,"*C").concat(G,",2)")},u.getCell(G,9).value={formula:"ROUND(E".concat(G,"*C").concat(G,",2)")},u.getCell(G,10).value={formula:"ROUND(F".concat(G,"*C").concat(G,",2)")},u.getCell(G,11).value={formula:"ROUND(G".concat(G,"*C").concat(G,",2)")},e.getCell(3).numFmt=b,[4,5,6,7,8,9,10,11]))e.getCell(t).numFmt=f;let i=(G-15)%2==1;for(let t=1;t<=11;t++){let a=e.getCell(t);i&&(a.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}}),a.border=x,a.font={...d,italic:!1},a.alignment=1===t?{wrapText:!0,vertical:"middle"}:{vertical:"middle",horizontal:"right"}}null===V&&(V=G),H=G,G++}}let $=e=>{u.getCell(e).font={...d,bold:!0}},X=G+1;for(let e of(u.getCell("A".concat(X)).value="Kopā",u.getCell("H".concat(X)).value={formula:V?"SUM(H".concat(V,":H").concat(H,")"):"0"},u.getCell("I".concat(X)).value={formula:V?"SUM(I".concat(V,":I").concat(H,")"):"0"},u.getCell("J".concat(X)).value={formula:V?"SUM(J".concat(V,":J").concat(H,")"):"0"},u.getCell("K".concat(X)).value={formula:V?"SUM(K".concat(V,":K").concat(H,")"):"0"},["H","I","J","K"]))u.getCell("".concat(e).concat(X)).numFmt=f;$("A".concat(X));let Q=X+1;u.getCell("A".concat(Q)).value="Materiālu, grunts apmaiņas un būvgružu transporta izdevumi",u.getCell("B".concat(Q)).value=.07,u.getCell("I".concat(Q)).value={formula:"ROUND(I".concat(X,"*B").concat(Q,",2)")},u.getCell("K".concat(Q)).value={formula:"I".concat(Q)},u.getCell("I".concat(Q)).numFmt=f,u.getCell("K".concat(Q)).numFmt=f;let ee=Q+1;for(let e of(u.getCell("A".concat(ee)).value="Tiešās izmaksas kopā",u.getCell("H".concat(ee)).value={formula:"H".concat(X)},u.getCell("I".concat(ee)).value={formula:"ROUND(I".concat(X,"+I").concat(Q,",2)")},u.getCell("J".concat(ee)).value={formula:"J".concat(X)},u.getCell("K".concat(ee)).value={formula:"ROUND(H".concat(ee,"+I").concat(ee,"+J").concat(ee,",2)")},["H","I","J","K"]))u.getCell("".concat(e).concat(ee)).numFmt=f;$("A".concat(ee));let et=ee+1;u.getCell("A".concat(et)).value="Virsizdevumi",u.getCell("B".concat(et)).value=.09,u.getCell("K".concat(et)).value={formula:"ROUND(K".concat(ee,"*B").concat(et,",2)")},u.getCell("K".concat(et)).numFmt=f;let ea=et+1;u.getCell("A".concat(ea)).value="Peļņa",u.getCell("B".concat(ea)).value=.07,u.getCell("K".concat(ea)).value={formula:"ROUND(K".concat(ee,"*B").concat(ea,",2)")},u.getCell("K".concat(ea)).numFmt=f;let en=ea+1;u.getCell("A".concat(en)).value="Darba devēja sociālais nodoklis",u.getCell("B".concat(en)).value=.2359,u.getCell("H".concat(en)).value={formula:"ROUND(H".concat(X,"*B").concat(en,",2)")},u.getCell("K".concat(en)).value={formula:"H".concat(en)},u.getCell("H".concat(en)).numFmt=f,u.getCell("K".concat(en)).numFmt=f;let el=en+1;u.getCell("A".concat(el)).value="Kopējās izmaksas",u.getCell("K".concat(el)).value={formula:"ROUND(K".concat(ee,"+K").concat(et,"+K").concat(ea,"+K").concat(en,",2)")},u.getCell("K".concat(el)).numFmt=f,$("A".concat(el)),$("K".concat(el));let ei=el+1;u.getCell("A".concat(ei)).value="PVN",u.getCell("B".concat(ei)).value=.21,u.getCell("K".concat(ei)).value={formula:"ROUND(K".concat(el,"*B").concat(ei,",2)")},u.getCell("K".concat(ei)).numFmt=f;let er=ei+1;for(let t of(u.getCell("A".concat(er)).value="Pavisam kopā",u.getCell("K".concat(er)).value={formula:"ROUND(K".concat(el,"+K").concat(ei,",2)")},u.getCell("K".concat(er)).numFmt=f,$("A".concat(er)),$("K".concat(er)),[X,Q,ee,et,ea,en,el,ei,er].forEach(e=>{u.getCell(e,4).value=0,u.getCell(e,4).numFmt=b}),u.getCell("I9").value="Tāmes summa euro :",u.getCell("K9").value={formula:"K".concat(el)},u.getCell("K9").numFmt=f,u.getCell("I10").value="PVN 21%:",u.getCell("K10").value={formula:"K".concat(ei)},u.getCell("K10").numFmt=f,u.getCell("I11").value="Pavisam kopā euro:",u.getCell("K11").value={formula:"K".concat(er)},u.getCell("K11").numFmt=f,u.getCell("K9").numFmt=f,u.getCell("K10").numFmt=f,u.getCell("K11").numFmt=f,[X,Q,ee,et,ea,en,el,ei,er]))for(let a=1;a<=11;a++){var e;let n=u.getCell(t,a);n.border=x,n.font={...d,bold:(null==(e=n.font)?void 0:e.bold)||!1},n.alignment=1===a?{wrapText:!0,vertical:"middle"}:{vertical:"middle",horizontal:"right"}}let eo=er+3;u.getCell("B".concat(eo)).value="Piezīmes:",u.getCell("B".concat(eo)).font={...d,bold:!0},u.mergeCells(eo,2,eo,12);let es=["1. Tāmes derīguma termiņš – 1 mēnesis.","2. Tāme sastādīta provizoriski, atbilstoši bojātā īpašuma apskates protokolam un bildēm.","3. Iespējami slēpti defekti, kurie atklāsies remontdarbu laikā.","4. Tāme ir sagatavota elektroniski un ir autorizēta ar Nr.".concat(_,".")],ec=[];"Jā"===eJ&&ec.push("Nepieciešama žāvēšana."),"Jā"===eV&&ec.push("Tika bojāts kopīpašums."),"Jā"===eH&&eY&&ec.push("Zaudējuma novērtējums pēc klienta vārdiem ir ".concat(eY," EUR."));let eu=[...es];ec.length>0&&(eu.push(""),eu.push(...ec));let ed=eo+1;for(let e of eu){u.mergeCells(ed,2,ed,12);let t=u.getCell(ed,2);t.value=e,t.font=d,t.alignment={wrapText:!0,vertical:"top"},ed++}for(let e of ef.map(e=>(e.note||"").trim()).filter(Boolean)){u.mergeCells(ed,2,ed,12);let t=u.getCell(ed,2);t.value=e,t.font=d,t.alignment={wrapText:!0,vertical:"top"},ed++}let em=ed+2;u.mergeCells(em,2,em,6),u.getCell(em,2).value="SASTĀDĪJA:",u.getCell(em,2).font={...d,bold:!0};let ep=(null==L?void 0:L.buvkomersantaNr)||"",eg=(null==L?void 0:L.fullName)||"",eh=(null==L?void 0:L.sertNr)||"";u.getCell(em+1,2).value="Būvkomersanta Nr.: ".concat(ep),u.mergeCells(em+1,3,em+1,6),u.getCell(em+2,2).value="Vārds, uzvārds: ".concat(eg),u.mergeCells(em+2,3,em+2,6),u.getCell(em+3,2).value="sert. nr.: ".concat(eh),u.mergeCells(em+3,3,em+3,6);let eb="Balta"===W?"AAS BALTA":W||"";u.mergeCells(em,9,em,12),u.getCell(em,9).value="SASKAŅOTS:",u.getCell(em,9).font={...d,bold:!0},u.mergeCells(em+1,9,em+1,12),u.getCell(em+1,9).value=eb,u.mergeCells(em+2,9,em+2,12),u.getCell(em+2,9).value="";let ey=[6,56,12,10,14,14,14,14,16,16,16,18];for(let e=1;e<=12;e++)u.getColumn(e).width=ey[e-1];s.removeWorksheet(c.id),u.name="Tāme";let ek={title:T,insurer:W,claimNumber:P,address:O,createdAt:new Date().toLocaleString("lv-LV"),id:_,rooms:ef.map(e=>"".concat(e.type," ").concat(e.index))};J(ek);let ej=await s.xlsx.writeBuffer();try{let e="eksperti_tames",t=new Uint8Array(ej),a="";for(let e=0;e<t.byteLength;e++)a+=String.fromCharCode(t[e]);let n=window.btoa(a),l=new Date,i={id:_,title:T,insurer:W,claimNumber:P,rooms:ef.map(e=>"".concat(e.type," ").concat(e.index)),createdAt:l.toLocaleString("lv-LV"),createdTs:l.getTime(),fileName:"".concat(D,".xlsx"),fileB64:n},r=[],o=localStorage.getItem(e);if(o)try{r=JSON.parse(o)||[]}catch(e){r=[]}let s=l.getTime();(r=r.filter(e=>e.createdTs&&s-e.createdTs<=6048e5)).unshift(i),localStorage.setItem(e,JSON.stringify(r))}catch(e){console.warn("Neizdevās saglabāt tāmi localStorage:",e)}let eC=new Blob([ej],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),ew=URL.createObjectURL(eC),eS=document.createElement("a");eS.href=ew,eS.download="".concat(D,".xlsx"),document.body.appendChild(eS),eS.click(),eS.remove(),URL.revokeObjectURL(ew),E(12),window.scrollTo({top:0,behavior:"smooth"})}catch(e){console.error("Excel export error:",e),alert("Neizdevās izveidot Excel failu. Skaties konsolē kļūdu.")}}let e5=(0,l.useCallback)(e=>t=>e(t.target.value),[]);(0,l.useCallback)(e=>t=>e(t.target.value),[]);let e9=Math.round((M-1)/11*100);return(0,n.jsx)("div",{style:{minHeight:"100vh",background:"#f7fafc",color:"#111827"},children:(0,n.jsxs)("div",{style:{maxWidth:1e3,margin:"0 auto",padding:16},children:[(0,n.jsx)("div",{style:{background:"white",padding:12,borderRadius:12,marginBottom:12},children:(0,n.jsx)(I,{label:"Lietas Nr.",children:(0,n.jsx)("input",{value:null!=P?P:"",onChange:e5(U),placeholder:"piem., CLV1234567",autoComplete:"off",spellCheck:!1,style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})}),(0,n.jsx)("header",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:16},children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{fontSize:22,fontWeight:800},children:["Apskates forma – solis ",M,"/",12]}),(0,n.jsx)("div",{style:{fontSize:13,color:"#4b5563"},children:"Tāmētājs ievada tikai daudzumu. Cenas netiek rādītas formā un parādīsies tikai gala tāmē."})]})}),(0,n.jsx)("div",{style:{height:8,background:"#e5e7eb",borderRadius:999,marginBottom:16},children:(0,n.jsx)("div",{style:{width:"".concat(e9,"%"),height:8,background:"#10b981",borderRadius:999}})}),1===M&&(0,n.jsx)(B,{title:"1. Objekta adrese",children:(0,n.jsx)(I,{label:"Objekta adrese",children:(0,n.jsx)("input",{value:null!=O?O:"",onChange:e5(V),placeholder:"Iela 1, Pilsēta",autoComplete:"off",spellCheck:!1,style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})}),2===M&&(0,n.jsxs)(B,{title:"2. Apdrošināšanas kompānija",children:[(0,n.jsx)(I,{label:"Izvēlies kompāniju",children:(0,n.jsx)("select",{value:W,onChange:e=>H(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:o.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})}),"Balta"===W&&(0,n.jsx)("div",{style:{fontSize:12,color:eS?"#b91c1c":"#065f46"},children:eS||(ex.length?"Ielādēts BALTA cenrādis (".concat(ex.length," pozīcijas)"):"Notiek BALTA cenrāža ielāde...")}),"Gjensidige"===W&&(0,n.jsx)("div",{style:{fontSize:12,color:eS?"#b91c1c":"#065f46"},children:eS||(ex.length?"Ielādēts GJENSIDIGE cenrādis (".concat(ex.length," pozīcijas)"):"Notiek GJENSIDIGE cenrāža ielāde...")}),"Swedbank"===W&&(0,n.jsx)("div",{style:{fontSize:12,color:eS?"#b91c1c":"#065f46"},children:eS||(ex.length?"Ielādēts SWEDBANK cenrādis (".concat(ex.length," pozīcijas)"):"Notiek SWEDBANK cenrāža ielāde...")})]}),3===M&&(0,n.jsxs)(B,{title:"3. Kur notika negadījums?",children:[(0,n.jsx)(I,{label:"Vieta",children:(0,n.jsxs)("select",{value:q,onChange:e=>Y(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,n.jsx)("option",{value:"",children:"— Izvēlies —"}),s.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})}),"Dzīvojamā ēka"===q&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I,{label:"3.1. Dzīvojamās ēkas tips",children:(0,n.jsxs)("select",{value:Z,onChange:e=>$(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,n.jsx)("option",{value:"",children:"— Izvēlies —"}),c.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})}),"Cits"===Z&&(0,n.jsx)(I,{label:"3.1.1. Norādi",children:(0,n.jsx)("input",{value:null!=X?X:"",onChange:e5(Q),placeholder:"NI tips",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})]})]}),4===M&&(0,n.jsxs)(B,{title:"4. Kas notika ar nekustamo īpašumu?",children:[(0,n.jsx)(I,{label:"Notikuma veids",children:(0,n.jsxs)("select",{value:ee,onChange:e=>et(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,n.jsx)("option",{value:"",children:"— Izvēlies —"}),u.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})}),"Cits"===ee&&(0,n.jsx)(I,{label:"4.1. Norādi",children:(0,n.jsx)("input",{value:null!=ea?ea:"",onChange:e5(en),placeholder:"Notikuma apraksts",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})]}),5===M&&(0,n.jsx)(B,{title:"5. Elektrības traucējumi",children:(0,n.jsxs)(I,{label:"Elektrības traucējumi",children:[(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,n.jsx)("input",{type:"radio",name:"el",checked:"ja"===eL,onChange:()=>eG("ja")})," Ir"]}),(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,n.jsx)("input",{type:"radio",name:"el",checked:"ne"===eL,onChange:()=>eG("ne")})," Nav"]})]})}),6===M&&(0,n.jsx)(B,{title:"6. Vai nepieciešama žāvēšana?",children:(0,n.jsxs)(I,{label:"Žāvēšana",children:[(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,n.jsx)("input",{type:"radio",name:"dry",checked:"Jā"===eJ,onChange:()=>eO("Jā")})," Jā"]}),(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,n.jsx)("input",{type:"radio",name:"dry",checked:"Nē"===eJ,onChange:()=>eO("Nē")})," Nē"]})]})}),7===M&&(0,n.jsx)(B,{title:"7. Vai bojāts kopīpašums?",children:(0,n.jsxs)(I,{label:"Kopīpašums",children:[(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,n.jsx)("input",{type:"radio",name:"common",checked:"Jā"===eV,onChange:()=>eW("Jā")})," Jā"]}),(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,n.jsx)("input",{type:"radio",name:"common",checked:"Nē"===eV,onChange:()=>eW("Nē")})," Nē"]})]})}),8===M&&(0,n.jsxs)(B,{title:"8. Zaudējuma novērtējums pēc klienta vārdiem",children:[(0,n.jsxs)(I,{label:"Vai ir zināma summa?",children:[(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,n.jsx)("input",{type:"radio",name:"lossKnown",checked:"Jā"===eH,onChange:()=>eq("Jā")})," ","Jā"]}),(0,n.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,n.jsx)("input",{type:"radio",name:"lossKnown",checked:"Nē"===eH,onChange:()=>eq("Nē")})," ","Nē"]})]}),"Jā"===eH&&(0,n.jsx)(I,{label:"Summa EUR",children:(0,n.jsx)("input",{type:"number",inputMode:"decimal",step:"0.01",value:eY,onChange:e=>eZ(e.target.value),style:{width:200,border:"1px solid #e5e7eb",borderRadius:10,padding:8},placeholder:"€ summa"})})]}),9===M&&(0,n.jsx)(B,{title:"9. Izvēlies telpu/as, kas tika bojātas",children:(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))",gap:12},children:d.map(e=>{var t;return(0,n.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[(0,n.jsxs)("label",{style:{fontWeight:600,display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("input",{type:"checkbox",checked:eg[e].checked,onChange:t=>eh({...eg,[e]:{...eg[e],checked:t.target.checked}})}),e]}),eg[e].checked&&(0,n.jsxs)("div",{style:{marginTop:8},children:["Cits"===e&&(0,n.jsx)("input",{value:String(null!=(t=eg[e].custom)?t:""),onChange:t=>eh({...eg,[e]:{...eg[e],custom:t.currentTarget.value}}),placeholder:"Telpas nosaukums",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,marginBottom:8}}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,n.jsx)("span",{children:"Daudzums:"}),(0,n.jsx)("input",{type:"number",min:1,value:eg[e].count,onChange:t=>eh({...eg,[e]:{...eg[e],count:Math.max(1,Number(t.target.value||1))}}),style:{width:90,border:"1px solid #e5e7eb",borderRadius:10,padding:6}})]})]})]},e)})})}),10===M&&(0,n.jsxs)(B,{title:"10. Izvēlētās telpas",children:[0===ef.length?(0,n.jsx)("div",{style:{color:"#6b7280"},children:"Nav izvēlētas telpas 9. solī."}):(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))",gap:12},children:ef.map(e=>{let t=(ev[e.id]||[]).filter(e=>e.itemUid&&e.quantity).length,a=(e.id,[]);return(0,n.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#f9fafb"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:6},children:[(0,n.jsxs)("div",{style:{fontWeight:700},children:[e.type," ",e.index]}),(0,n.jsx)("button",{type:"button",onClick:()=>(function(e){let[t,a]=String(e).split("-"),n=parseInt(a,10)||1;ey(e=>{var a,l;let i={...e},r=(null==(a=eg[t])?void 0:a.checked)?Number((null==(l=eg[t])?void 0:l.count)||1):0;if(r<=0)return i;for(let e=n+1;e<=r;e++){let a="".concat(t,"-").concat(e),n="".concat(t,"-").concat(e-1);i[a]&&(i[n]=i[a])}return delete i["".concat(t,"-").concat(r)],i}),eh(e=>{let a=e[t];if(!a)return e;let n=(Number(a.count)||1)-1,l={...e};return n<=0?l[t]={...a,checked:!1,count:1}:l[t]={...a,checked:!0,count:n},l}),ej(t=>t===e?null:t)})(e.id),title:"Dzēst telpu",style:{marginLeft:"auto",padding:"4px 8px",borderRadius:8,border:"1px solid #e5e7eb",background:"white"},children:"Dzēst"})]}),(0,n.jsxs)("div",{style:{fontSize:13,color:"#4b5563",marginBottom:8},children:["Pozīcijas: ",t]}),a.length>0&&(0,n.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:8},children:a.map(e=>(0,n.jsx)("span",{style:{background:"#e5e7eb",borderRadius:999,padding:"4px 10px",fontSize:12},children:e},e))}),(0,n.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,n.jsx)("button",{type:"button",onClick:()=>{ej(e.id),E(11)},style:{padding:"8px 12px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Atvērt"})})]},e.id)})}),ef.length>0&&(0,n.jsxs)("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)("button",{type:"button",onClick:()=>E(9),style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:"+ Pievienot vēl telpu"}),ef.every(e=>(ev[e.id]||[]).some(e=>e.itemUid&&e.quantity))&&(0,n.jsx)("button",{type:"button",onClick:e7,style:{padding:"12px 16px",borderRadius:12,background:"#059669",color:"white",border:0},children:"Viss pabeigts — izveidot tāmi"})]})]}),11===M&&ek&&(0,n.jsxs)(B,{title:"11. Pozīcijas un apjomi – ".concat(null==(t=ef.find(e=>e.id===ek))?void 0:t.type," ").concat(null==(i=ef.find(e=>e.id===ek))?void 0:i.index),children:[(0,n.jsx)(I,{label:"Piezīmes",children:(0,n.jsx)("input",{value:null!=(T=null==(A=ef.find(e=>e.id===ek))?void 0:A.note)?T:"",onChange:e=>{var t;return t=e.target.value,void eb(e=>e.map(e=>e.id===ek?{...e,note:t}:e))},placeholder:"Papildus informācija",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})}),(ev[ek]||[{category:"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]).map((e,t)=>{var a,l;let i=(e.category||"").trim(),r="Swedbank"===W&&v.has(i)&&!e.swedAuto;return(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1.1fr 2.2fr 1fr 0.8fr auto",gap:8,alignItems:"end",marginBottom:8},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Kategorija"}),(0,n.jsxs)("select",{value:null!=(a=e.category)?a:"",onChange:e=>(function(e,t,a){let n=(a||"").trim();ey(a=>{let l=[...a[e]||[]],i={...l[t],category:n,itemUid:"",itemId:"",itemName:"",unit:"",unit_price:null,labor:0,materials:0,mechanisms:0};return"Swedbank"===W&&v.has(n)&&(i.swedSurfacePos="",i.swedSurfaceVariant="",i.swedAuto=!1),l[t]=i,{...a,[e]:l}})})(ek,t,(e.target.value||"").trim()),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,n.jsx)("option",{value:"",children:"— visas —"}),e0.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{style:{position:"relative"},children:[(0,n.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Pozīcija"}),r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("select",{value:e.swedSurfacePos||"",onChange:a=>{let n=a.target.value;e8(ek,t,"swedSurfacePos",n),e8(ek,t,"swedSurfaceVariant",""),n&&"Ģipškartons un krāsojamās tapetes vai tapetes"!==n&&e6(ek,t,e.category,n,"")},style:{width:"100%",padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:[(0,n.jsx)("option",{value:"",children:"— izvēlies pozīciju —"}),(0,n.jsx)("option",{value:"Krāsots betons",children:"Krāsots betons"}),(0,n.jsx)("option",{value:"Krāsots ģipškartons",children:"Krāsots ģipškartons"}),(0,n.jsx)("option",{value:"Ģipškartons un krāsojamās tapetes vai tapetes",children:"Ģipškartons un krāsojamās tapetes vai tapetes"})]}),"Ģipškartons un krāsojamās tapetes vai tapetes"===e.swedSurfacePos&&(0,n.jsxs)("div",{style:{marginTop:8},children:[(0,n.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Veids"}),(0,n.jsxs)("select",{value:e.swedSurfaceVariant||"",onChange:a=>{let n=a.target.value;e8(ek,t,"swedSurfaceVariant",n),n&&e6(ek,t,e.category,e.swedSurfacePos,n)},style:{width:"100%",padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:[(0,n.jsx)("option",{value:"",children:"— izvēlies —"}),(0,n.jsx)("option",{value:"krasojamas",children:"Krāsojamās tapetes"}),(0,n.jsx)("option",{value:"tapetes",children:"Tapetes"})]})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{type:"button",onClick:()=>{let e="".concat(ek,"-").concat(t);eF(t=>t===e?null:e),eM("")},style:{width:"100%",padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white",textAlign:"left",cursor:"pointer"},children:"Swedbank"===W&&("Griesti"===i||"Sienas, ailes"===i)&&e.swedSurfacePos?e.swedSurfacePos+(e.swedSurfaceVariant?" \xb7 ".concat(e.swedSurfaceVariant):""):e.itemName?e.itemName+(e.unit?" \xb7 ".concat(e.unit):""):"— izvēlies pozīciju —"}),eE==="".concat(ek,"-").concat(t)&&(0,n.jsxs)("div",{style:{position:"absolute",zIndex:50,top:"100%",left:0,right:0,marginTop:4,background:"white",border:"1px solid #e5e7eb",borderRadius:10,boxShadow:"0 10px 30px rgba(15,23,42,0.18)",maxHeight:320,overflowY:"auto"},children:[(0,n.jsx)("div",{style:{padding:8,borderBottom:"1px solid #e5e7eb",position:"sticky",top:0,background:"white"},children:(0,n.jsx)("input",{autoFocus:!0,placeholder:"Meklēt pozīciju.",value:eD,onChange:e=>eM(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:8,padding:6,fontSize:14}})}),ex.filter(t=>{if("Gjensidige"===W){let e=w(t.name);if(S.has(e)||e$.has(e))return!1}if(!(!e.category||t.category===e.category||t.subcategory===e.category)||z(t)||t.is_section)return!1;let a=eD.trim().toLowerCase();return!a||"".concat(t.name," ").concat(t.subcategory||"").toLowerCase().includes(a)}).map(e=>(0,n.jsxs)("button",{type:"button",onClick:()=>{var a=e.uid;let n=ex.find(e=>e.uid===a);ey(e=>{let a=[...e[ek]||[]];return n?a[t]={...a[t],category:n.category||a[t].category||"",itemUid:n.uid,itemId:n.id,itemName:n.name,unit:n.unit||"",unit_price:C(n,h),labor:C(n,m),materials:C(n,p),mechanisms:C(n,g)}:a[t]={...a[t],itemUid:"",itemId:"",itemName:"",unit:"",unit_price:null,labor:0,materials:0,mechanisms:0},{...e,[ek]:a}}),eF(null),eM("")},style:{display:"block",width:"100%",padding:"8px 12px",border:"none",borderBottom:"1px solid #f3f4f6",background:"white",textAlign:"left",fontSize:14,cursor:"pointer"},children:["Swedbank"!==W&&e.subcategory?"[".concat(e.subcategory,"] "):"",e.name," \xb7 ",e.unit||"—"]},e.uid))]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Mērv."}),(0,n.jsxs)("select",{value:k(e.unit)||"",onChange:e=>e8(ek,t,"unit",k(e.target.value)),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,n.jsx)("option",{value:"",children:"—"}),ew.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Daudz."}),(0,n.jsx)("input",{type:"number",min:0,step:"0.01",value:null!=(l=e.quantity)?l:"",onChange:e=>e8(ek,t,"quantity",e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8},autoComplete:"off",placeholder:"Skaitlis"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"flex-end"},children:[(0,n.jsx)("button",{type:"button",onClick:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";ey(a=>({...a,[e]:[...a[e]||[],{category:t||"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]}))})(ek,e.category||""),style:{padding:"8px 12px",borderRadius:10,background:"#111827",color:"white",border:0},children:"+ Rinda"}),(0,n.jsx)("button",{type:"button",onClick:()=>{ey(e=>{let a=e[ek]||[];return a.length<=1?e:{...e,[ek]:a.filter((e,a)=>a!==t)}})},style:{padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:"Dzēst"})]})]},t)}),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:(0,n.jsx)("button",{type:"button",onClick:()=>{ej(null),E(10)},style:{padding:"10px 14px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Saglabāt un atgriezties"})})]}),12===M&&(0,n.jsxs)(B,{title:"Tāme izveidota un lejupielādēta",children:[(0,n.jsx)("p",{style:{marginBottom:16},children:"Excel tāme ir lejupielādēta. Ko vēlies darīt tālāk?"}),(0,n.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,n.jsx)("button",{type:"button",onClick:()=>{E(1)},style:{padding:"10px 16px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Sākt jaunu tāmi"}),(0,n.jsx)("button",{type:"button",onClick:()=>{D?D():window.location.href="".concat(window.location.pathname.replace(/\/$/,""),"/tames/")},style:{padding:"10px 16px",borderRadius:10,border:"1px solid #e5e7eb",background:"white",color:"#111827"},children:"Atpakaļ uz saglabātajām tāmēm"})]})]}),[1,2,3,4,5,6,7,8,9,12].includes(M)&&(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:16},children:[(0,n.jsx)("button",{type:"button",onClick:()=>E(e=>Math.max(1,e-1)),disabled:1===M,style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:1===M?"#f3f4f6":"white",color:"#111827"},children:"← Atpakaļ"}),(0,n.jsx)("button",{type:"button",onClick:()=>E(e=>Math.min(12,e+1)),disabled:!e3||12===M,style:{padding:"10px 14px",borderRadius:10,background:e3&&12!==M?"#111827":"#9ca3af",color:"white",border:0},children:12===M?"Beigas":"Tālāk →"})]}),(0,n.jsx)("div",{style:{background:"white",padding:16,borderRadius:12,marginTop:20},children:(0,n.jsx)(r(),{href:"/eksperti/tames",style:{display:"inline-block",padding:"10px 16px",borderRadius:999,background:"#111827",color:"white",textDecoration:"none",fontWeight:600,fontSize:14},children:"Apskatīt izveidotās tāmes"})}),(0,n.jsx)("footer",{style:{paddingBottom:40,marginTop:12,fontSize:12,color:"#6b7280"},children:"Piezīme: forma nerāda apakšpozīcijas; Excel tās pievieno automātiski (saites, iebūvētie vai blakus esošie)."})]})})}}}]);