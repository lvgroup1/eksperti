"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{4857:(e,t,l)=>{l.r(t),l.d(t,{default:()=>R});var a=l(7876),i=l(4232),n=l(8230),r=l.n(n);let o=["Swedbank","Gjensidige","Compensa","IF","BTA","Balta"],s=["Komerctelpa","Dzīvojamā ēka"],c=["Privātmāja","Daudzdzīvokļu māja","Rindu māja","Cits"],u=["CTA","Plūdi","Uguns","Koks","Cits"],d=["Virtuve","Guļamistaba","Koridors","Katla telpa","Dzīvojamā istaba","Vannas istaba","Tualete","Garderobe","Cits"],m=["labor","darbs"],p=["materials","materiāli","materiali","materjali","materiālu izmaksas","materialu izmaksas","mater.","mater","materiāli (eur)","materiāli eur"],g=["mechanisms","mehānismi","mehanismi","mehānismu","meh","meh izmaksas","mehizmaksas","mehānismu izmaksas","mehānismi (eur)","mehānismi eur"],h=["unit_price","unitprice","vienības cena","vienibas cena","cena","vienc","vienības cena eur"],f=["Griesti","Sienas, ailes","Grīdas","Citi apdares darbi","Jumts","Fasāde","Citi darbi un izmaksas","Telpu kopšana","Būvgružu utilizācija"];function b(e){if(!e)return"";let t=String(e).trim().toLowerCase().replace("\xb2","2").replace("\xa0"," ").replace(/\s{2,}/g," ");return["gb.","gab.","gab"].includes(t)?"gab":["m2","m 2","m^2"].includes(t)?"m2":["m3","m 3","m^3"].includes(t)?"m3":"m"===t?"m":["kpl","kpl."].includes(t)?"kpl":"diena"===t?"diena":"c/h"===t?"c/h":["obj.","obj"].includes(t)?"obj":/^\d+\s*gb\.$/.test(t)?"gab":t}function v(e){if(null==e||""===e)return 0;let t=parseFloat(String(e).replace(/\s+/g,"").replace(",","."));return Number.isFinite(t)?t:0}function y(e){var t,l,a,i;if(!e)return!1;let n=(e.name||"").trim();if(!n)return!1;let r=b(e.unit||""),o=v(null!=(t=e.labor)?t:0)+v(null!=(l=e.materials)?l:0)+v(null!=(a=e.mechanisms)?a:0)+v(null!=(i=e.unit_price)?i:0);if(!((!r||"nan"===r||"-"===r)&&0===o))return!1;let s=n.toLowerCase();return!["transports","tiešās izmaksas kopā","tiesas izmaksas kopa","virsizdevumi","virsizdevumi","peļņa","pelna","sociālais nodoklis","socialais nodoklis","kopā","pvn","sastādīja","sastadija",'sia "lv group"',"sert."].some(e=>s.includes(e))}function x(e,t){if(!e||"object"!=typeof e)return 0;let l=e=>String(null!=e?e:"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(RegExp("[^\\p{L}\\p{N}]+","gu"),"").trim(),a=Object.entries(e).map(e=>{let[t,a]=e;return[l(t),a]}),i=t.map(l);for(let[e,t]of a)if(i.includes(e)){let e=v(t);if(Number.isFinite(e))return e}let n=i.flatMap(e=>e.includes("labor")||e.includes("darbs")?["labor","darbs"]:e.includes("material")?["material","materiali","mater"]:e.includes("mechanism")||e.includes("meh")?["mechanism","meh"]:e.includes("cena")||e.includes("unitprice")?["cena","unitprice"]:[e]);for(let[e,t]of a)if(n.some(t=>e.includes(t))){let e=v(t);if(Number.isFinite(e))return e}return 0}let j=e=>String(null!=e?e:"").toLowerCase().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(RegExp("[^\\p{L}\\p{N}]+","gu")," ").replace(/\s+/g," ").trim(),C=new Set([j("Ģipškartona konstrukcija"),j("Griestu sagatavošanas darbi"),j("Balsinājums"),j("Balinājums")]);function k(e){return String(null!=e?e:"").normalize("NFD").replace(RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/[.,;:()\[\]{}]/g," ").replace(/\s+/g," ").trim()}function w(e){return!0===e||1===e||"1"===e||"string"==typeof e&&["true","yes","y","jā"].includes(e.trim().toLowerCase())}function S(e){return w(e.is_child)||w(e.child)||!!e.parent_uid||!!e.parentUid||!!e.parent_id||!!e.parentId||!!e.parent||!!e.parent_name||!!e.parentName||!!e.childOf||!!e.parentKey||!!e.parent_key}function N(e,t){var l,a,i,n,r,o;let s=Number(null!=(l=null==e?void 0:e.labor)?l:0)||0,c=Number(null!=(a=null==e?void 0:e.mechanisms)?a:0)||0,u=Number(null!=(i=null==e?void 0:e.unit_price)?i:0)||0,d=Number(null!=(n=null==e?void 0:e.materials)?n:s||c?0:u)||0;return{name:(null==e?void 0:e.name)||"",unit:b((null==e?void 0:e.unit)||t||""),coeff:Number(null!=(o=null!=(r=null==e?void 0:e.coeff)?r:null==e?void 0:e.multiplier)?o:1)||1,labor:s,materials:d,mechanisms:c,unit_price_raw:u}}function z(e){for(let t of["children","komponentes","apaks","apakšpozīcijas","components","componentes","subitems","sub_items","items","pozicijas","pozīcijas"])if(Array.isArray(e[t]))return e[t];for(let[t,l]of Object.entries(e))if(Array.isArray(l)&&l.some(e=>e&&"object"==typeof e&&(e.name||e.title)))return l;return[]}let _=i.memo(function(e){let{label:t,children:l}=e;return(0,a.jsxs)("div",{style:{marginBottom:12},children:[(0,a.jsx)("div",{style:{fontWeight:600,marginBottom:6},children:t}),(0,a.jsx)("div",{children:l})]})}),A=i.memo(function(e){let{title:t,children:l}=e;return(0,a.jsxs)("div",{style:{background:"white",padding:16,borderRadius:12,boxShadow:"0 1px 4px rgba(0,0,0,0.06)"},children:[(0,a.jsx)("div",{style:{fontSize:18,fontWeight:700,marginBottom:10},children:t}),l]})});function R(e){var t,n,w,R;let{onBackToList:L}=e,[B,I]=(0,i.useState)(1),D=(0,i.useMemo)(()=>{var e;let t=!!(null==(e=window.__NEXT_DATA__)?void 0:e.assetPrefix),l=window.location.pathname.startsWith("/eksperti");return t||l?"/eksperti":""},[]),[M,T]=(0,i.useState)(""),[E,F]=(0,i.useState)(null),J=i.useCallback(e=>{try{let t=(e=>{let t=(null==e?void 0:e.email)||(null==e?void 0:e.id)||(null==e?void 0:e.fullName)||"anonymous";return"eksperti_tames_".concat(t)})(E),l=localStorage.getItem(t),a=l?JSON.parse(l):[],i=[e,...a].slice(0,50);localStorage.setItem(t,JSON.stringify(i))}catch(e){console.error("Neizdevās saglabāt tāmi:",e)}},[E]),[U,O]=(0,i.useState)(""),[K,P]=(0,i.useState)("Balta"),[G,V]=(0,i.useState)(""),[W,q]=(0,i.useState)(""),[H,Y]=(0,i.useState)(""),[Z,$]=(0,i.useState)(""),[X,Q]=(0,i.useState)(""),[ee,et]=(0,i.useState)("Nē"),[el,ea]=(0,i.useState)("Nē"),[ei,en]=(0,i.useState)("Nē"),[er,eo]=(0,i.useState)("Nē"),[es,ec]=(0,i.useState)(""),[eu,ed]=(0,i.useState)(d.reduce((e,t)=>(e[t]={checked:!1,count:1,custom:""},e),{})),[em,ep]=(0,i.useState)([]),[eg,eh]=(0,i.useState)({}),[ef,eb]=(0,i.useState)(null),[ev,ey]=(0,i.useState)([]),[ex,ej]=(0,i.useState)(""),[eC,ek]=(0,i.useState)(new Map),[ew,eS]=(0,i.useState)(new Map),[eN,ez]=(0,i.useState)(new Map),[e_,eA]=(0,i.useState)(""),[eR,eL]=(0,i.useState)(""),[eB,eI]=(0,i.useState)(null);(0,i.useMemo)(()=>{let e=new Map;for(let t of ev)e.set(String(t.id),t);return e},[ev]),(0,i.useMemo)(()=>{let e=new Map;for(let t of ev){let l=j(t.name);l&&e.set(l,t)}return e},[ev]),(0,i.useMemo)(()=>{let e=new Map;for(let t of ev){let l="".concat(j(t.category),"||").concat(j(t.name));l&&e.set(l,t)}return e},[ev]);let[eD,eM]=(0,i.useState)({}),[eT,eE]=(0,i.useState)(null),[eF,eJ]=(0,i.useState)(null),[eU,eO]=(0,i.useState)(null),[eK,eP]=(0,i.useState)(null),[eG,eV]=(0,i.useState)("");(0,i.useEffect)(()=>{try{let e=localStorage.getItem("eksperti_user");if(e){let t=JSON.parse(e);F(t)}}catch(e){console.warn("Neizdevās nolasīt ielogoto lietotāju:",e)}},[]),(0,i.useEffect)(()=>{let e=!1;return(async()=>{try{let t="".concat(D,"/prices/child_hints.json");"Gjensidige"===K&&(t="".concat(D,"/prices/gjensidige_child_hints.json"));let l=await fetch(t,{cache:"no-store"});if(!l.ok)return;let a=await l.json();if(e||!a||"object"!=typeof a)return;let i={},n=e=>j(e);for(let[e,t]of Object.entries(a))i[n(e)]=Array.isArray(t)?t:[];eM(i)}catch(e){}})(),()=>{e=!0}},[D,K]),(0,i.useEffect)(()=>{window.__PC=ev},[ev]),(0,i.useEffect)(()=>{window.dumpPC=()=>{let e=window.__PC||[];return{rows:e.length,withMaterials:e.filter(e=>(e.materials||0)>0).length,withMechanisms:e.filter(e=>(e.mechanisms||0)>0).length,sample:e.slice(0,3)}}},[]),(0,i.useEffect)(()=>{if(!["Balta","Gjensidige","Swedbank"].includes(K)){ek(new Map),eS(new Map),ez(new Map),ey([]);return}ej(""),(async()=>{try{let e=async e=>{let t=await fetch(e,{cache:"no-store"});if(!t.ok)throw Error("".concat(t.status," ").concat(t.statusText));let l=await t.json();return Array.isArray(l)?l:Array.isArray(l.items)?l.items:[]},t=[],l="";if("Balta"===K){try{t=await e("".concat(D,"/prices/balta.v2.json")),l="balta.v2.json"}catch(e){}if(!t.length)try{t=await e("".concat(D,"/prices/balta.json")),l="balta.json"}catch(e){ej("Neizdevās ielādēt BALTA cenas: ".concat(e.message));return}}else if("Gjensidige"===K)try{let a=await e("".concat(D,"/prices/gjensidige.json"));if(!Array.isArray(a)||!a.length)return void ej("Neizdevās ielādēt GJENSIDIGE cenrādi (gjensidige.json ir tukšs vai bojāts).");let i=e=>{let t=v(e);return Number.isFinite(t)?t:0},n=a.filter(e=>e&&(e.name||e.Nosaukums)).map((e,t)=>{var l,a,n,r,o,s,c,u,d,m,p,g,h,f,v,y,x,j,C,k,w;let S=String(null!=(a=null!=(l=e.name)?l:e.Nosaukums)?a:"").trim(),N=String(null!=(r=null!=(n=e.category)?n:e.Kategorija)?r:"").trim(),z=String(null!=(c=null!=(s=null!=(o=e.subcategory)?o:e.Apakkategorija)?s:e["Apakškategorija"])?c:"").trim(),_=b(null!=(m=null!=(d=null!=(u=e.unit)?u:e["Mērv."])?d:e.Merv)?m:""),A=String(null!=(p=e.id)?p:t),R=String(null!=(g=e.uid)?g:[N,z,A,S].join("::"));return{id:A,uid:R,name:S,category:N,subcategory:z,unit:_,unit_price:i(null!=(f=null!=(h=e.unit_price)?h:e["Vienības cena"])?f:e.cena),labor:i(null!=(v=e.labor)?v:e.Darbs),materials:i(null!=(x=null!=(y=e.materials)?y:e.Materiāli)?x:e["Materiāli.1"]),mechanisms:i(null!=(k=null!=(C=null!=(j=e.mechanisms)?j:e["Mehā-nismi"])?C:e.Mehanismi)?k:e["Mehā-nismi.1"]),is_child:!!(e.is_child||e.parent_uid),parent_uid:e.parent_uid||null,coeff:i(null!=(w=e.coeff)?w:1)||1}}),r="";t=n=n.map(e=>{if(y(e))return r=(e.name||"").trim(),{...e,category:r};let t=(e.category||r||"").trim();return{...e,category:t}}),l="gjensidige.json"}catch(e){ej("Neizdevās ielādēt GJENSIDIGE cenrādi: ".concat(e.message));return}else if("Swedbank"===K)try{if(t=await e("".concat(D,"/prices/swedbank.json")),!Array.isArray(t)||!t.length)return void ej("Neizdevās ielādēt SWEDBANK cenrādi (swedbank.json ir tukšs vai bojāts).");l="swedbank.json"}catch(e){ej("Neizdevās ielādēt SWEDBANK cenrādi: ".concat(e.message));return}let a=[],i=[],n=[];if(t.forEach((e,t)=>{var l,r,o;let s=(e.category||"").trim(),c=(e.subcategory||e.subcat||e.group||e.grupa||e["apakškategorija"]||"").trim(),u=String(null!=(l=e.id)?l:t),d=(e.name||"").trim(),f=[s,c,u,d].join("::"),y=e.parent_uid||e.parentUid||e.parent_id||e.parentId||e.parent||e.parent_name||e.parentName||e.childOf||null,j=!!y,C={id:u,uid:f,name:d,category:s,subcategory:c,unit:b(e.unit),unit_price:x(e,h),labor:x(e,m),materials:x(e,p),mechanisms:x(e,g),is_child:j,parent_uid:y||null,is_section:!!e.is_section};if(j){let t={...C,coeff:v(null!=(o=null!=(r=e.coeff)?r:e.multiplier)?o:1)||1};i.push(t),n.push(t)}else{let t={...C,is_child:!1,parent_uid:null};a.push(t),n.push(t);let l=Array.isArray(e.children)&&e.children||Array.isArray(e.komponentes)&&e.komponentes||Array.isArray(e.apaks)&&e.apaks||Array.isArray(e["apakšpozīcijas"])&&e["apakšpozīcijas"]||[];l.length&&(t.children=[],l.forEach((l,a)=>{var r,o;let d=(l.name||l.title||"").trim();if(!d)return;let y={id:"".concat(u,"-c").concat(a),uid:[s,c,"".concat(u,"-c").concat(a),d].join("::"),name:d,category:s,subcategory:c,unit:b(l.unit||e.unit),unit_price:x(l,h),labor:x(l,m),materials:x(l,p),mechanisms:x(l,g),is_child:!0,parent_uid:f,coeff:v(null!=(o=null!=(r=l.coeff)?r:l.multiplier)?o:1)||1,is_section:!1};i.push(y),n.push(y),t.children.push({name:y.name,unit:y.unit,coeff:y.coeff||1,labor:y.labor||0,materials:y.materials||0,mechanisms:y.mechanisms||0})}))}}),"balta.v2.json"===l&&0===i.length)try{let t=await e("".concat(D,"/prices/balta.json"));if(function(e,t){let l=new Map,a=new Map,i=(e,t)=>"".concat(String(e||"").trim().toLowerCase(),"|").concat(String(t||"").trim().toLowerCase());for(let e of t){var n;if(!z(e).length)continue;let t=String(null!=(n=e.id)?n:"");t&&l.set(t,e),a.set(i(e.category,e.name),e)}let r=0;for(let t of e){let e=l.get(String(t.id)),n=a.get(i(t.category,t.name)),o=e||n;if(!o)continue;let s=z(o);s.length&&(t.children=s.map(e=>{var l,a;return{name:(e.name||e.title||"").trim(),unit:b(e.unit||o.unit||t.unit||""),coeff:v(null!=(a=null!=(l=e.coeff)?l:e.multiplier)?a:1)||1,labor:x(e,m),materials:x(e,p),mechanisms:x(e,g),unit_price:x(e,h)}}).filter(e=>e.name),t.children.length&&r++)}return r}(a,t)>0)for(let e of a)Array.isArray(e.children)&&e.children.length&&e.children.forEach((t,l)=>{let a={id:"".concat(e.id,"-c").concat(l),uid:[e.category||"",e.subcategory||"","".concat(e.id,"-c").concat(l),t.name].join("::"),name:t.name,category:e.category||"",subcategory:e.subcategory||"",unit:b(t.unit||e.unit),unit_price:Number(t.unit_price||0),labor:Number(t.labor||0),materials:Number(t.materials||0),mechanisms:Number(t.mechanisms||0),is_child:!0,parent_uid:e.uid,coeff:Number(t.coeff||1)||1,is_section:!1};i.push(a),n.push(a)})}catch(e){}let r=new Map,o=null;for(let e of n){if(!e.is_child){o=e;continue}if(o&&e.category===o.category&&e.subcategory===o.subcategory){let t=r.get(o.uid)||[],l=N(e,o.unit);t.some(e=>j(e.name)===j(l.name)&&b(e.unit)===b(l.unit))||t.push(l),r.set(o.uid,t)}}for(let e of a){if(!Array.isArray(e.children)||!e.children.length)continue;let t=r.get(e.uid)||[];for(let l of e.children){let a=N(l,e.unit);t.some(e=>j(e.name)===j(a.name)&&b(e.unit)===b(a.unit))||t.push(a)}t.length&&r.set(e.uid,t)}let s=[...a,...i],c=new Map,u=new Map;for(let e of s){let t=j(e.name),l=j(e.category);c.has(t)||c.set(t,[]),c.get(t).push(e),u.set("".concat(l,"|").concat(t),e)}ey(s),eS(c),ez(u),ek(r),window.__PC=s,console.log("[BALTA] exposed __PC:",{rows:s.length,withMaterials:s.filter(e=>(e.materials||0)>0).length,withMechanisms:s.filter(e=>(e.mechanisms||0)>0).length,children:i.length,adjParents:[...r.keys()].length}),console.log("[BALTA] loaded:",{source:l,full:s.length,parents:a.length,children:i.length,splitParents:a.filter(e=>(e.labor||0)+(e.materials||0)+(e.mechanisms||0)>0).length,splitChildren:i.filter(e=>(e.labor||0)+(e.materials||0)+(e.mechanisms||0)>0).length,adjParents:[...r.keys()].length})}catch(e){ej("Neizdevās ielādēt BALTA cenas: ".concat(e.message))}})()},[K,D]);let eW=(0,i.useMemo)(()=>{let e=new Set;if(!eD||"object"!=typeof eD)return e;for(let t of Object.values(eD))if(Array.isArray(t))for(let l of t){let t="string"==typeof l?l:null==l?void 0:l.name;t&&e.add(j(t))}return e},[eD]),eq=(0,i.useCallback)((e,t)=>{let l=j(e),a=j(t),i="".concat(a,"|").concat(l);if(eN.has(i))return eN.get(i);let n=ew.get(l);if(Array.isArray(n)&&n.length)return n[0];for(let[e,t]of eN.entries()){let[i,n]=e.split("|");if(i===a&&n.includes(l))return t}return null},[ew,eN]),eH=(0,i.useCallback)(e=>{if(!e)return[];let t=[],l=new Set,a=(e,a)=>{let i=N(e,a),n="".concat(j(null==i?void 0:i.name),"::").concat(b((null==i?void 0:i.unit)||""));i.name&&!l.has(n)&&(l.add(n),t.push(i))};if(Array.isArray(e.children)&&e.children.length)for(let t of e.children)a(t,e.unit);for(let t of ev)S(t)&&function(e,t){let l=new Set([t.uid,t.id,t.name,"".concat(t.category,"::").concat(t.name)].map(k).filter(Boolean));return[e.parent_uid,e.parentUid,e.parent_id,e.parentId,e.parent,e.parent_name,e.parentName,e.childOf,e.parent_key,e.parentKey].map(k).filter(Boolean).some(e=>l.has(e))}(t,e)&&a(t,e.unit);let i=eC.get(e.uid);if(Array.isArray(i)&&i.length)for(let t of i)a(t,e.unit);let n=eD[j(e.name)];if(Array.isArray(n))for(let t of n){let l="string"==typeof t?t:null==t?void 0:t.name;if(!l)continue;let i=Number("object"==typeof t&&(null==t?void 0:t.coeff)?t.coeff:1)||1,n="object"==typeof t&&(null==t?void 0:t.unit)?t.unit:void 0,r=eq(l,e.category)||function(e,t,l){let a=j(e),i=j(t),n=l.find(e=>j(e.name)===a&&j(e.category)===i);return n||(n=l.find(e=>j(e.name)===a))||(n=l.find(e=>j(e.category)===i&&j(e.name).includes(a)))?n:(n=l.find(e=>j(e.name).includes(a)))||null}(l,e.category,ev);a(r?{...r,unit:n||r.unit||e.unit,coeff:i,labor:x(r,m),materials:x(r,p),mechanisms:x(r,g),unit_price:x(r,h)}:{name:l,unit:n||e.unit,coeff:i,labor:0,materials:0,mechanisms:0,unit_price:0},e.unit)}return t},[ev,eD,eC,eq]),eY=(0,i.useMemo)(()=>{if(!ev.length)return[];if("Swedbank"===K)return f;if("Gjensidige"===K){let e=ev.filter(e=>y(e)).map(e=>(e.name||"").trim()).filter(Boolean);if(e.length)return Array.from(new Set(e))}return Array.from(new Set(ev.map(e=>(e.category||"").trim()).filter(Boolean)))},[ev,K]),[eZ,e$]=(0,i.useState)([]);function eX(e,t,l,a){eh(i=>{let n=[...i[e]||[]],r={...n[t],[l]:a};return n[t]=r,{...i,[e]:n}})}(0,i.useEffect)(()=>e$(function(){try{let e=localStorage.getItem("tames_profils_saglabatie");return e?JSON.parse(e):[]}catch(e){return[]}}()),[]),(0,i.useEffect)(()=>{let e=[];Object.entries(eu).forEach(t=>{let[l,a]=t;if(!a.checked)return;let i=Math.max(1,Number(a.count)||1);for(let t=1;t<=i;t++){let i="".concat(l,"-").concat(t),n=em.find(e=>e.id===i);e.push({id:i,type:"Cits"===l?a.custom||"Cits":l,index:t,note:(null==n?void 0:n.note)||""})}}),ep(e),eh(t=>{let l={};return e.forEach(e=>{l[e.id]=t[e.id]||[{category:"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]}),l})},[eu]);let eQ=(0,i.useMemo)(()=>{switch(B){case 1:return!!U.trim();case 2:return!!K;case 3:return!!G&&("Dzīvojamā ēka"!==G||!!W);case 4:return!!Z&&("Cits"!==Z||!!X.trim());case 5:return["Jā","Nē"].includes(ee);case 6:return["Jā","Nē"].includes(el);case 7:return["Jā","Nē"].includes(ei);case 8:if(!eK)return!1;if("Nē"===eK)return!0;return eG&&Number(eG)>0;case 9:return Object.values(eu).some(e=>e.checked);default:return!0}},[B,U,K,G,W,Z,X,ee,el,ei,eK,eG,eu]);async function e0(){try{let t=e=>String(e).padStart(2,"0"),a=await l.e(22).then(l.t.bind(l,1980,23)),i=(null==a?void 0:a.default)||a,n="".concat(D,"/templates/balta_template.xlsx"),r=await fetch(n);if(!r.ok)return void alert("Neizdevās ielādēt ".concat(n,". Pārliecinies, ka fails ir public/templates/balta_template.xlsx"));let o=await r.arrayBuffer(),s=new i.Workbook;await s.xlsx.load(o);let c=s.getWorksheet("Tāme")||s.worksheets[0],u=s.addWorksheet("Tāme (izvade)",{views:[{showGridLines:!1}]}),d={name:"Calibri",size:11},m="#,##0.00",p="#,##0.00",g={style:"thin"},h={top:g,left:g,bottom:g,right:g},f={type:"pattern",pattern:"solid",fgColor:{argb:"FFF3F6FD"}},y={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFEFEF"}},x=new Date,j="".concat(x.getFullYear()).concat(t(x.getMonth()+1)).concat(t(x.getDate())),C="",k=(C="Swedbank"===K?"S":"Balta"===K?"B":"")?"".concat(C,"-").concat(j):j,w="";w="Swedbank"===K||"Balta"===K?"LOKĀLĀ TĀME NR.".concat(k):"TĀMES NR.: ".concat(k);let S=x.toLocaleDateString("lv-LV",{year:"numeric",month:"long",day:"numeric"}),N="".concat(K||"Tame","_").concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e=>String(e).padStart(2,"0");return"".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate()),"_").concat(t(e.getHours()),"-").concat(t(e.getMinutes()))}()),z=window.prompt("Norādi tāmes nosaukumu (piemēram, 'Virtuve griesti 3. stāvs'):",N);if(null===z)return;let _=(z=z.trim()||N).normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_\-]+/g,"_");u.getCell("A1").value="Pasūtītājs: ".concat(K||"Balta"),u.getCell("A2").value="Objekts: ".concat(G||"").concat(W?" – "+W:""),u.getCell("A3").value="Objekta adrese: ".concat(U||""),u.getCell("A8").value="Rīga, ".concat(S),u.getCell("A9").value="Pamatojums: apdrošināšanas lieta Nr. ".concat(M||"—"),u.getCell("J1").value="LV GROUP SIA",u.getCell("J2").value="Reģ. Nr.: LV40103160668",u.mergeCells(6,2,6,12);let A=u.getCell(6,2);A.value=w,A.font={...d,size:16,bold:!0},A.alignment={horizontal:"center",vertical:"middle"};let R=[];if(em.forEach(e=>{(eg[e.id]||[]).forEach(t=>{var l,a,i,n,r,o,s,c,u,d,m,p,g,h;let f=v(t.quantity);if(!f)return;let y=ev.find(e=>e.uid===t.itemUid)||ev.find(e=>e.id===t.itemId);if(!y)return;let x=b(t.unit||y.unit||""),j=v(null!=(a=null!=(l=t.labor)?l:y.labor)?a:0),C=v(null!=(n=null!=(i=t.materials)?i:y.materials)?n:0),k=v(null!=(o=null!=(r=t.mechanisms)?r:y.mechanisms)?o:0),w=j+C+k||v(null!=(c=null!=(s=t.unit_price)?s:y.unit_price)?c:0);for(let l of(R.push({isChild:!1,room:"".concat(e.type," ").concat(e.index),name:t.itemName||y.name||"",unit:x,qty:f,labor:j,materials:C,mechanisms:k,unitPrice:w}),eH(y))){let t=v(null!=(u=l.coeff)?u:1)*f,a=v(null!=(d=l.labor)?d:0),i=v(null!=(m=l.materials)?m:0),n=v(null!=(p=l.mechanisms)?p:0),r=a+i+n||v(null!=(h=null!=(g=l.unit_price)?g:l.unit_price_raw)?h:0);R.push({isChild:!0,room:"".concat(e.type," ").concat(e.index),name:l.name||"",unit:b(l.unit||x),qty:t,labor:a,materials:i,mechanisms:n,unitPrice:r})}})}),!R.length)return void alert("Nav nevienas pozīcijas ar daudzumu.");for(let e of(u.getCell(13,1).value="Nr.",u.getCell(13,2).value="Darbu nosaukums",u.getCell(13,3).value="Mērv.",u.getCell(13,4).value="Daudz.",u.mergeCells(13,5,13,8),u.getCell(13,5).value="Vienības cena, EUR",u.mergeCells(13,9,13,12),u.getCell(13,9).value="Summa, EUR",u.getCell(14,5).value="Darbs",u.getCell(14,6).value="Materiāli",u.getCell(14,7).value="Mehānismi",u.getCell(14,8).value="Cena",u.getCell(14,9).value="Darbs",u.getCell(14,10).value="Materiāli",u.getCell(14,11).value="Mehānismi",u.getCell(14,12).value="Kopā",[13,14])){let t=u.getRow(e);for(let e=1;e<=12;e++){let l=t.getCell(e);l.font={...d,bold:!0},l.alignment={horizontal:"center",vertical:"middle",wrapText:!0},l.fill=y,l.border=h}t.height=22}let L=15,B=1,T=null,F=null,O=new Map;for(let[e,t]of(R.forEach(e=>{O.has(e.room)||O.set(e.room,[]),O.get(e.room).push(e)}),O.entries())){u.mergeCells(L,2,L,12);let l=u.getCell(L,2);for(let a of(l.value=e,l.fill=f,l.font={...d,bold:!0},l.alignment={wrapText:!0,vertical:"middle"},l.border={bottom:g},u.getRow(L).height=18,L++,t)){let e=u.getRow(L);e.getCell(1).value=a.isChild?"":B++,e.getCell(2).value=a.isChild?"    ".concat(a.name):a.name,e.getCell(3).value=a.unit,e.getCell(4).value=a.qty;let t=Number(a.labor||0),l=Number(a.materials||0),i=Number(a.mechanisms||0);if(t+l+i>0)u.getCell(L,5).value=t,u.getCell(L,6).value=l,u.getCell(L,7).value=i;else{let e=Number(a.unitPrice||0);u.getCell(L,5).value=0,u.getCell(L,6).value=e,u.getCell(L,7).value=0}for(let t of(u.getCell(L,8).value={formula:"ROUND(SUM(E".concat(L,":G").concat(L,"),2)")},u.getCell(L,9).value={formula:"ROUND(E".concat(L,"*D").concat(L,",2)")},u.getCell(L,10).value={formula:"ROUND(F".concat(L,"*D").concat(L,",2)")},u.getCell(L,11).value={formula:"ROUND(G".concat(L,"*D").concat(L,",2)")},u.getCell(L,12).value={formula:"ROUND(H".concat(L,"*D").concat(L,",2)")},e.getCell(4).numFmt=p,[5,6,7,8,9,10,11,12]))e.getCell(t).numFmt=m;let n=(L-15)%2==1;for(let t=1;t<=12;t++){let l=e.getCell(t);n&&(l.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}}),l.border=h,l.font={...d,italic:!!a.isChild},l.alignment=2===t?{wrapText:!0,vertical:"middle"}:{vertical:"middle",horizontal:"right"}}null===T&&(T=L),F=L,L++}}let P=e=>{u.getCell(e).font={...d,bold:!0}},V=L+1;for(let e of(u.getCell("B".concat(V)).value="Kopā",u.getCell("I".concat(V)).value={formula:T?"SUM(I".concat(T,":I").concat(F,")"):"0"},u.getCell("J".concat(V)).value={formula:T?"SUM(J".concat(T,":J").concat(F,")"):"0"},u.getCell("K".concat(V)).value={formula:T?"SUM(K".concat(T,":K").concat(F,")"):"0"},u.getCell("L".concat(V)).value={formula:T?"SUM(L".concat(T,":L").concat(F,")"):"0"},[9,10,11,12]))u.getCell(V,e).numFmt=m;P("B".concat(V));let q=V+1;u.getCell("B".concat(q)).value="Materiālu, grunts apmaiņas un būvgružu transporta izdevumi",u.getCell("C".concat(q)).value=.07,u.getCell("J".concat(q)).value={formula:"ROUND(J".concat(V,"*C").concat(q,",2)")},u.getCell("L".concat(q)).value={formula:"J".concat(q)},u.getCell("J".concat(q)).numFmt=m,u.getCell("L".concat(q)).numFmt=m;let H=q+1;for(let e of(u.getCell("B".concat(H)).value="Tiešās izmaksas kopā",u.getCell("I".concat(H)).value={formula:"I".concat(V)},u.getCell("J".concat(H)).value={formula:"ROUND(J".concat(V,"+J").concat(q,",2)")},u.getCell("K".concat(H)).value={formula:"K".concat(V)},u.getCell("L".concat(H)).value={formula:"ROUND(I".concat(H,"+J").concat(H,"+K").concat(H,",2)")},[9,10,11,12]))u.getCell(H,e).numFmt=m;P("B".concat(H));let Y=H+1;u.getCell("B".concat(Y)).value="Virsizdevumi",u.getCell("C".concat(Y)).value=.09,u.getCell("L".concat(Y)).value={formula:"ROUND(L".concat(H,"*C").concat(Y,",2)")},u.getCell("L".concat(Y)).numFmt=m;let Z=Y+1;u.getCell("B".concat(Z)).value="Peļņa",u.getCell("C".concat(Z)).value=.07,u.getCell("L".concat(Z)).value={formula:"ROUND(L".concat(H,"*C").concat(Z,",2)")},u.getCell("L".concat(Z)).numFmt=m;let $=Z+1;u.getCell("B".concat($)).value="Darba devēja sociālais nodoklis",u.getCell("C".concat($)).value=.2359,u.getCell("I".concat($)).value={formula:"ROUND(I".concat(V,"*C").concat($,",2)")},u.getCell("L".concat($)).value={formula:"I".concat($)},u.getCell("I".concat($)).numFmt=m,u.getCell("L".concat($)).numFmt=m;let X=$+1;u.getCell("B".concat(X)).value="Kopējās izmaksas",u.getCell("L".concat(X)).value={formula:"ROUND(L".concat(H,"+L").concat(Y,"+L").concat(Z,"+L").concat($,",2)")},u.getCell("L".concat(X)).numFmt=m,P("B".concat(X)),P("L".concat(X));let Q=X+1;u.getCell("B".concat(Q)).value="PVN",u.getCell("C".concat(Q)).value=.21,u.getCell("L".concat(Q)).value={formula:"ROUND(L".concat(X,"*C").concat(Q,",2)")},u.getCell("L".concat(Q)).numFmt=m;let ee=Q+1;for(let t of(u.getCell("B".concat(ee)).value="Pavisam kopā",u.getCell("L".concat(ee)).value={formula:"ROUND(L".concat(X,"+L").concat(Q,",2)")},u.getCell("L".concat(ee)).numFmt=m,P("B".concat(ee)),P("L".concat(ee)),[V,q,H,Y,Z,$,X,Q,ee].forEach(e=>{u.getCell(e,4).value=0,u.getCell(e,4).numFmt=p}),u.getCell("J9").value="Tāmes summa euro :",u.getCell("L9").value={formula:"L".concat(X)},u.getCell("L9").numFmt=m,u.getCell("J10").value="PVN 21%:",u.getCell("L10").value={formula:"L".concat(Q)},u.getCell("L10").numFmt=m,u.getCell("J11").value="Pavisam kopā euro:",u.getCell("L11").value={formula:"L".concat(ee)},u.getCell("L11").numFmt=m,[V,q,H,Y,Z,$,X,Q,ee]))for(let l=1;l<=12;l++){var e;let a=u.getCell(t,l);a.border=h,a.font={...d,bold:(null==(e=a.font)?void 0:e.bold)||!1},a.alignment=2===l?{wrapText:!0,vertical:"middle"}:{vertical:"middle",horizontal:"right"}}let et=ee+3;u.getCell("B".concat(et)).value="Piezīmes:",u.getCell("B".concat(et)).font={...d,bold:!0},u.mergeCells(et,2,et,12);let el=["1. Tāmes derīguma termiņš – 1 mēnesis.","2. Tāme sastādīta provizoriski, atbilstoši bojātā īpašuma apskates protokolam un bildēm.","3. Iespējami slēpti defekti, kurie atklāsies remontdarbu laikā.","4. Tāme ir sagatavota elektroniski un ir autorizēta ar Nr.".concat(k,".")],ea=[];"Jā"===eF&&ea.push("Nepieciešama žāvēšana."),"Jā"===eU&&ea.push("Tika bojāts kopīpašums."),"Jā"===eK&&eG&&ea.push("Zaudējuma novērtējums pēc klienta vārdiem ir ".concat(eG," EUR."));let ei=[...el];ea.length>0&&(ei.push(""),ei.push(...ea));let en=et+1;for(let e of ei){u.mergeCells(en,2,en,12);let t=u.getCell(en,2);t.value=e,t.font=d,t.alignment={wrapText:!0,vertical:"top"},en++}for(let e of em.map(e=>(e.note||"").trim()).filter(Boolean)){u.mergeCells(en,2,en,12);let t=u.getCell(en,2);t.value=e,t.font=d,t.alignment={wrapText:!0,vertical:"top"},en++}let er=en+2;u.mergeCells(er,2,er,6),u.getCell(er,2).value="SASTĀDĪJA:",u.getCell(er,2).font={...d,bold:!0};let eo=(null==E?void 0:E.buvkomersantaNr)||"",es=(null==E?void 0:E.fullName)||"",ec=(null==E?void 0:E.sertNr)||"";u.getCell(er+1,2).value="Būvkomersanta Nr.: ".concat(eo),u.mergeCells(er+1,3,er+1,6),u.getCell(er+2,2).value="Vārds, uzvārds: ".concat(es),u.mergeCells(er+2,3,er+2,6),u.getCell(er+3,2).value="sert. nr.: ".concat(ec),u.mergeCells(er+3,3,er+3,6);let eu="Balta"===K?"AAS BALTA":K||"";u.mergeCells(er,9,er,12),u.getCell(er,9).value="SASKAŅOTS:",u.getCell(er,9).font={...d,bold:!0},u.mergeCells(er+1,9,er+1,12),u.getCell(er+1,9).value=eu,u.mergeCells(er+2,9,er+2,12),u.getCell(er+2,9).value="";let ed=[6,56,12,10,14,14,14,14,16,16,16,18];for(let e=1;e<=12;e++)u.getColumn(e).width=ed[e-1];s.removeWorksheet(c.id),u.name="Tāme";let ep={title:z,insurer:K,claimNumber:M,address:U,createdAt:new Date().toLocaleString("lv-LV"),id:k,rooms:em.map(e=>"".concat(e.type," ").concat(e.index))};J(ep);let eh=await s.xlsx.writeBuffer();try{let e="eksperti_tames",t=new Uint8Array(eh),l="";for(let e=0;e<t.byteLength;e++)l+=String.fromCharCode(t[e]);let a=window.btoa(l),i=new Date,n={id:k,title:z,insurer:K,claimNumber:M,rooms:em.map(e=>"".concat(e.type," ").concat(e.index)),createdAt:i.toLocaleString("lv-LV"),createdTs:i.getTime(),fileName:"".concat(_,".xlsx"),fileB64:a},r=[],o=localStorage.getItem(e);if(o)try{r=JSON.parse(o)||[]}catch(e){r=[]}let s=i.getTime();(r=r.filter(e=>e.createdTs&&s-e.createdTs<=6048e5)).unshift(n),localStorage.setItem(e,JSON.stringify(r))}catch(e){console.warn("Neizdevās saglabāt tāmi localStorage:",e)}let ef=new Blob([eh],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),eb=URL.createObjectURL(ef),ey=document.createElement("a");ey.href=eb,ey.download="".concat(_,".xlsx"),document.body.appendChild(ey),ey.click(),ey.remove(),URL.revokeObjectURL(eb),I(12),window.scrollTo({top:0,behavior:"smooth"})}catch(e){console.error("Excel export error:",e),alert("Neizdevās izveidot Excel failu. Skaties konsolē kļūdu.")}}let e1=(0,i.useCallback)(e=>t=>e(t.target.value),[]);(0,i.useCallback)(e=>t=>e(t.target.value),[]);let e2=Math.round((B-1)/11*100);return(0,a.jsx)("div",{style:{minHeight:"100vh",background:"#f7fafc",color:"#111827"},children:(0,a.jsxs)("div",{style:{maxWidth:1e3,margin:"0 auto",padding:16},children:[(0,a.jsx)("div",{style:{background:"white",padding:12,borderRadius:12,marginBottom:12},children:(0,a.jsx)(_,{label:"Lietas Nr.",children:(0,a.jsx)("input",{value:null!=M?M:"",onChange:e1(T),placeholder:"piem., CLV1234567",autoComplete:"off",spellCheck:!1,style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})}),(0,a.jsx)("header",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:16},children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{fontSize:22,fontWeight:800},children:["Apskates forma – solis ",B,"/",12]}),(0,a.jsx)("div",{style:{fontSize:13,color:"#4b5563"},children:"Tāmētājs ievada tikai daudzumu. Cenas netiek rādītas formā un parādīsies tikai gala tāmē."})]})}),(0,a.jsx)("div",{style:{height:8,background:"#e5e7eb",borderRadius:999,marginBottom:16},children:(0,a.jsx)("div",{style:{width:"".concat(e2,"%"),height:8,background:"#10b981",borderRadius:999}})}),1===B&&(0,a.jsx)(A,{title:"1. Objekta adrese",children:(0,a.jsx)(_,{label:"Objekta adrese",children:(0,a.jsx)("input",{value:null!=U?U:"",onChange:e1(O),placeholder:"Iela 1, Pilsēta",autoComplete:"off",spellCheck:!1,style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})}),2===B&&(0,a.jsxs)(A,{title:"2. Apdrošināšanas kompānija",children:[(0,a.jsx)(_,{label:"Izvēlies kompāniju",children:(0,a.jsx)("select",{value:K,onChange:e=>P(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:o.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})}),"Balta"===K&&(0,a.jsx)("div",{style:{fontSize:12,color:ex?"#b91c1c":"#065f46"},children:ex||(ev.length?"Ielādēts BALTA cenrādis (".concat(ev.length," pozīcijas)"):"Notiek BALTA cenrāža ielāde...")}),"Gjensidige"===K&&(0,a.jsx)("div",{style:{fontSize:12,color:ex?"#b91c1c":"#065f46"},children:ex||(ev.length?"Ielādēts GJENSIDIGE cenrādis (".concat(ev.length," pozīcijas)"):"Notiek GJENSIDIGE cenrāža ielāde...")}),"Swedbank"===K&&(0,a.jsx)("div",{style:{fontSize:12,color:ex?"#b91c1c":"#065f46"},children:ex||(ev.length?"Ielādēts SWEDBANK cenrādis (".concat(ev.length," pozīcijas)"):"Notiek SWEDBANK cenrāža ielāde...")})]}),3===B&&(0,a.jsxs)(A,{title:"3. Kur notika negadījums?",children:[(0,a.jsx)(_,{label:"Vieta",children:(0,a.jsxs)("select",{value:G,onChange:e=>V(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— Izvēlies —"}),s.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),"Dzīvojamā ēka"===G&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_,{label:"3.1. Dzīvojamās ēkas tips",children:(0,a.jsxs)("select",{value:W,onChange:e=>q(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— Izvēlies —"}),c.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),"Cits"===W&&(0,a.jsx)(_,{label:"3.1.1. Norādi",children:(0,a.jsx)("input",{value:null!=H?H:"",onChange:e1(Y),placeholder:"NI tips",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})]})]}),4===B&&(0,a.jsxs)(A,{title:"4. Kas notika ar nekustamo īpašumu?",children:[(0,a.jsx)(_,{label:"Notikuma veids",children:(0,a.jsxs)("select",{value:Z,onChange:e=>$(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— Izvēlies —"}),u.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})}),"Cits"===Z&&(0,a.jsx)(_,{label:"4.1. Norādi",children:(0,a.jsx)("input",{value:null!=X?X:"",onChange:e1(Q),placeholder:"Notikuma apraksts",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})})]}),5===B&&(0,a.jsx)(A,{title:"5. Elektrības traucējumi",children:(0,a.jsxs)(_,{label:"Elektrības traucējumi",children:[(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"el",checked:"ja"===eT,onChange:()=>eE("ja")})," Ir"]}),(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"radio",name:"el",checked:"ne"===eT,onChange:()=>eE("ne")})," Nav"]})]})}),6===B&&(0,a.jsx)(A,{title:"6. Vai nepieciešama žāvēšana?",children:(0,a.jsxs)(_,{label:"Žāvēšana",children:[(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"dry",checked:"Jā"===eF,onChange:()=>eJ("Jā")})," Jā"]}),(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"radio",name:"dry",checked:"Nē"===eF,onChange:()=>eJ("Nē")})," Nē"]})]})}),7===B&&(0,a.jsx)(A,{title:"7. Vai bojāts kopīpašums?",children:(0,a.jsxs)(_,{label:"Kopīpašums",children:[(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"common",checked:"Jā"===eU,onChange:()=>eO("Jā")})," Jā"]}),(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"radio",name:"common",checked:"Nē"===eU,onChange:()=>eO("Nē")})," Nē"]})]})}),8===B&&(0,a.jsxs)(A,{title:"8. Zaudējuma novērtējums pēc klienta vārdiem",children:[(0,a.jsxs)(_,{label:"Vai ir zināma summa?",children:[(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8,marginRight:16},children:[(0,a.jsx)("input",{type:"radio",name:"lossKnown",checked:"Jā"===eK,onChange:()=>eP("Jā")})," ","Jā"]}),(0,a.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"radio",name:"lossKnown",checked:"Nē"===eK,onChange:()=>eP("Nē")})," ","Nē"]})]}),"Jā"===eK&&(0,a.jsx)(_,{label:"Summa EUR",children:(0,a.jsx)("input",{type:"number",inputMode:"decimal",step:"0.01",value:eG,onChange:e=>eV(e.target.value),style:{width:200,border:"1px solid #e5e7eb",borderRadius:10,padding:8},placeholder:"€ summa"})})]}),9===B&&(0,a.jsx)(A,{title:"9. Izvēlies telpu/as, kas tika bojātas",children:(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(240px,1fr))",gap:12},children:d.map(e=>{var t;return(0,a.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[(0,a.jsxs)("label",{style:{fontWeight:600,display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("input",{type:"checkbox",checked:eu[e].checked,onChange:t=>ed({...eu,[e]:{...eu[e],checked:t.target.checked}})}),e]}),eu[e].checked&&(0,a.jsxs)("div",{style:{marginTop:8},children:["Cits"===e&&(0,a.jsx)("input",{value:String(null!=(t=eu[e].custom)?t:""),onChange:t=>ed({...eu,[e]:{...eu[e],custom:t.currentTarget.value}}),placeholder:"Telpas nosaukums",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,marginBottom:8}}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("span",{children:"Daudzums:"}),(0,a.jsx)("input",{type:"number",min:1,value:eu[e].count,onChange:t=>ed({...eu,[e]:{...eu[e],count:Math.max(1,Number(t.target.value||1))}}),style:{width:90,border:"1px solid #e5e7eb",borderRadius:10,padding:6}})]})]})]},e)})})}),10===B&&(0,a.jsxs)(A,{title:"10. Izvēlētās telpas",children:[0===em.length?(0,a.jsx)("div",{style:{color:"#6b7280"},children:"Nav izvēlētas telpas 9. solī."}):(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))",gap:12},children:em.map(e=>{let t=(eg[e.id]||[]).filter(e=>e.itemUid&&e.quantity).length,l=(e.id,[]);return(0,a.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12,background:"#f9fafb"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:6},children:[(0,a.jsxs)("div",{style:{fontWeight:700},children:[e.type," ",e.index]}),(0,a.jsx)("button",{type:"button",onClick:()=>(function(e){let[t,l]=String(e).split("-"),a=parseInt(l,10)||1;eh(e=>{var l,i;let n={...e},r=(null==(l=eu[t])?void 0:l.checked)?Number((null==(i=eu[t])?void 0:i.count)||1):0;if(r<=0)return n;for(let e=a+1;e<=r;e++){let l="".concat(t,"-").concat(e),a="".concat(t,"-").concat(e-1);n[l]&&(n[a]=n[l])}return delete n["".concat(t,"-").concat(r)],n}),ed(e=>{let l=e[t];if(!l)return e;let a=(Number(l.count)||1)-1,i={...e};return a<=0?i[t]={...l,checked:!1,count:1}:i[t]={...l,checked:!0,count:a},i}),eb(t=>t===e?null:t)})(e.id),title:"Dzēst telpu",style:{marginLeft:"auto",padding:"4px 8px",borderRadius:8,border:"1px solid #e5e7eb",background:"white"},children:"Dzēst"})]}),(0,a.jsxs)("div",{style:{fontSize:13,color:"#4b5563",marginBottom:8},children:["Pozīcijas: ",t]}),l.length>0&&(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginBottom:8},children:l.map(e=>(0,a.jsx)("span",{style:{background:"#e5e7eb",borderRadius:999,padding:"4px 10px",fontSize:12},children:e},e))}),(0,a.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,a.jsx)("button",{type:"button",onClick:()=>{eb(e.id),I(11)},style:{padding:"8px 12px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Atvērt"})})]},e.id)})}),em.length>0&&(0,a.jsxs)("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("button",{type:"button",onClick:()=>I(9),style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:"+ Pievienot vēl telpu"}),em.every(e=>(eg[e.id]||[]).some(e=>e.itemUid&&e.quantity))&&(0,a.jsx)("button",{type:"button",onClick:e0,style:{padding:"12px 16px",borderRadius:12,background:"#059669",color:"white",border:0},children:"Viss pabeigts — izveidot tāmi"})]})]}),11===B&&ef&&(0,a.jsxs)(A,{title:"11. Pozīcijas un apjomi – ".concat(null==(t=em.find(e=>e.id===ef))?void 0:t.type," ").concat(null==(n=em.find(e=>e.id===ef))?void 0:n.index),children:[(0,a.jsx)(_,{label:"Piezīmes",children:(0,a.jsx)("input",{value:null!=(R=null==(w=em.find(e=>e.id===ef))?void 0:w.note)?R:"",onChange:e=>{var t;return t=e.target.value,void ep(e=>e.map(e=>e.id===ef?{...e,note:t}:e))},placeholder:"Papildus informācija",autoComplete:"off",style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8}})}),(eg[ef]||[{category:"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]).map((e,t)=>{var l,i;return(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1.1fr 2.2fr 1fr 0.8fr auto",gap:8,alignItems:"end",marginBottom:8},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Kategorija"}),(0,a.jsxs)("select",{value:null!=(l=e.category)?l:"",onChange:e=>{var l;return l=e.target.value,void eh(e=>{let a=[...e[ef]||[]];return a[t]={...a[t],category:l,itemUid:"",itemId:"",itemName:"",unit:"",unit_price:null,labor:0,materials:0,mechanisms:0},{...e,[ef]:a}})},style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"— visas —"}),eY.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{style:{position:"relative"},children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Pozīcija"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e="".concat(ef,"-").concat(t);eI(t=>t===e?null:e),eL("")},style:{width:"100%",padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white",textAlign:"left",cursor:"pointer"},children:e.itemName?e.itemName+(e.unit?" \xb7 ".concat(e.unit):""):"— izvēlies pozīciju —"}),eB==="".concat(ef,"-").concat(t)&&(0,a.jsxs)("div",{style:{position:"absolute",zIndex:50,top:"100%",left:0,right:0,marginTop:4,background:"white",border:"1px solid #e5e7eb",borderRadius:10,boxShadow:"0 10px 30px rgba(15,23,42,0.18)",maxHeight:320,overflowY:"auto"},children:[(0,a.jsx)("div",{style:{padding:8,borderBottom:"1px solid #e5e7eb",position:"sticky",top:0,background:"white"},children:(0,a.jsx)("input",{autoFocus:!0,placeholder:"Meklēt pozīciju...",value:eR,onChange:e=>eL(e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:8,padding:6,fontSize:14}})}),ev.filter(t=>{if("Gjensidige"===K){let e=j(t.name);if(C.has(e)||eW.has(e))return!1}if(!(!e.category||t.category===e.category||t.subcategory===e.category)||S(t)||t.is_section)return!1;let l=eR.trim().toLowerCase();return!l||"".concat(t.name," ").concat(t.subcategory||"").toLowerCase().includes(l)}).map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>{var l=e.uid;let a=ev.find(e=>e.uid===l);eh(e=>{let l=[...e[ef]||[]];return a?l[t]={...l[t],category:a.category||l[t].category||"",itemUid:a.uid,itemId:a.id,itemName:a.name,unit:a.unit||"",unit_price:x(a,h),labor:x(a,m),materials:x(a,p),mechanisms:x(a,g)}:l[t]={...l[t],itemUid:"",itemId:"",itemName:"",unit:"",unit_price:null,labor:0,materials:0,mechanisms:0},{...e,[ef]:l}}),eI(null),eL("")},style:{display:"block",width:"100%",padding:"8px 12px",border:"none",borderBottom:"1px solid #f3f4f6",background:"white",textAlign:"left",fontSize:14,cursor:"pointer"},children:["Swedbank"!==K&&e.subcategory?"[".concat(e.subcategory,"] "):"",e.name," \xb7 ",e.unit||"—"]},e.uid))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Mērv."}),(0,a.jsxs)("select",{value:b(e.unit)||"",onChange:e=>eX(ef,t,"unit",b(e.target.value)),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8,background:"white"},children:[(0,a.jsx)("option",{value:"",children:"—"}),allUnits.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontSize:13,marginBottom:4},children:"Daudz."}),(0,a.jsx)("input",{type:"number",min:0,step:"0.01",value:null!=(i=e.quantity)?i:"",onChange:e=>eX(ef,t,"quantity",e.target.value),style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:10,padding:8},autoComplete:"off",placeholder:"Skaitlis"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"flex-end"},children:[(0,a.jsx)("button",{type:"button",onClick:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";eh(l=>({...l,[e]:[...l[e]||[],{category:t||"",itemUid:"",itemId:"",itemName:"",quantity:"",unit:"",unit_price:null}]}))})(ef,e.category||""),style:{padding:"8px 12px",borderRadius:10,background:"#111827",color:"white",border:0},children:"+ Rinda"}),(0,a.jsx)("button",{type:"button",onClick:()=>{eh(e=>{let l=e[ef]||[];return l.length<=1?e:{...e,[ef]:l.filter((e,l)=>l!==t)}})},style:{padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb",background:"white"},children:"Dzēst"})]})]},t)}),(0,a.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:(0,a.jsx)("button",{type:"button",onClick:()=>{eb(null),I(10)},style:{padding:"10px 14px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Saglabāt un atgriezties"})})]}),12===B&&(0,a.jsxs)(A,{title:"Tāme izveidota un lejupielādēta",children:[(0,a.jsx)("p",{style:{marginBottom:16},children:"Excel tāme ir lejupielādēta. Ko vēlies darīt tālāk?"}),(0,a.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,a.jsx)("button",{type:"button",onClick:()=>{I(1)},style:{padding:"10px 16px",borderRadius:10,background:"#111827",color:"white",border:0},children:"Sākt jaunu tāmi"}),(0,a.jsx)("button",{type:"button",onClick:()=>{L?L():window.location.href="".concat(window.location.pathname.replace(/\/$/,""),"/tames/")},style:{padding:"10px 16px",borderRadius:10,border:"1px solid #e5e7eb",background:"white",color:"#111827"},children:"Atpakaļ uz saglabātajām tāmēm"})]})]}),[1,2,3,4,5,6,7,8,9,12].includes(B)&&(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:16},children:[(0,a.jsx)("button",{type:"button",onClick:()=>I(e=>Math.max(1,e-1)),disabled:1===B,style:{padding:"10px 14px",borderRadius:10,border:"1px solid #e5e7eb",background:1===B?"#f3f4f6":"white",color:"#111827"},children:"← Atpakaļ"}),(0,a.jsx)("button",{type:"button",onClick:()=>I(e=>Math.min(12,e+1)),disabled:!eQ||12===B,style:{padding:"10px 14px",borderRadius:10,background:eQ&&12!==B?"#111827":"#9ca3af",color:"white",border:0},children:12===B?"Beigas":"Tālāk →"})]}),(0,a.jsx)("div",{style:{background:"white",padding:16,borderRadius:12,marginTop:20},children:(0,a.jsx)(r(),{href:"/eksperti/tames",style:{display:"inline-block",padding:"10px 16px",borderRadius:999,background:"#111827",color:"white",textDecoration:"none",fontWeight:600,fontSize:14},children:"Apskatīt izveidotās tāmes"})}),(0,a.jsx)("footer",{style:{paddingBottom:40,marginTop:12,fontSize:12,color:"#6b7280"},children:"Piezīme: forma nerāda apakšpozīcijas; Excel tās pievieno automātiski (saites, iebūvētie vai blakus esošie)."})]})})}}}]);